<!DOCTYPE html>
<!--
    So Simple Jekyll Theme 3.1.0
    Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/so-simple-theme/blob/master/LICENSE
-->
<html lang="en-US" class="no-js">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  

  
    
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Rubyist-c12-File and IO operations | Cavenâ€™s</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Rubyist-c12-File and IO operations" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This chapter covers Â  Keyboard input and screen output é”®ç›˜è¾“å…¥ä¸å±å¹•è¾“å‡º" />
<meta property="og:description" content="This chapter covers Â  Keyboard input and screen output é”®ç›˜è¾“å…¥ä¸å±å¹•è¾“å‡º" />
<link rel="canonical" href="http://localhost:4000/learning%20notes/programming/chapter-12-File-and-I-O-operations/" />
<meta property="og:url" content="http://localhost:4000/learning%20notes/programming/chapter-12-File-and-I-O-operations/" />
<meta property="og:site_name" content="Cavenâ€™s" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-11-30T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"url":"http://localhost:4000/learning%20notes/programming/chapter-12-File-and-I-O-operations/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/learning%20notes/programming/chapter-12-File-and-I-O-operations/"},"description":"This chapter covers Â  Keyboard input and screen output é”®ç›˜è¾“å…¥ä¸å±å¹•è¾“å‡º","@type":"BlogPosting","headline":"Rubyist-c12-File and IO operations","dateModified":"2017-11-30T00:00:00+08:00","datePublished":"2017-11-30T00:00:00+08:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/css/main.css">
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,700,700i|Lora:400,400i,700,700i">
  <link rel="alternate" type="application/atom+xml" title="Caven&#39;s" href="/atom.xml">
<!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

</head>


  <body class="layout--post  rubyist-c12-file-and-io-operations">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
  <div class="navigation-wrapper">
    <a href="#menu-toggle" id="menu-toggle">Menu</a>
    <nav id="primary-nav" class="site-nav animated drop">
      <ul><li><a href="/">Home</a></li><li><a href="/categories/">Categories</a></li><li><a href="/tags/">Tags</a></li><li><a href="/search/">Search</a></li></ul>
    </nav>
  </div><!-- /.navigation-wrapper -->


    <header class="masthead">
  <div class="wrap">
    
    
      <h1 class="site-title animated fadeIn"><a href="/">Caven's</a></h1>
      <p class="site-description animated fadeIn" itemprop="description">Record</p>
    
  </div>
</header><!-- /.masthead -->


    <main id="main" class="main-content" aria-label="Content">
  <article class="h-entry">
    

    <div class="page-wrapper">
      <header class="page-header">
        
        
          <h1 id="page-title" class="page-title p-name">Rubyist-c12-File and IO operations
</h1>
        
      </header>

      <div class="page-sidebar">
        <div class="page-author h-card p-author"><div class="author-info"><ul class="author-links"><li class="author-link">
            <a class="u-url" rel="me" href=""><i class="fas fa-link fa-lg" title=""></i></a>
          </li></ul>
    <time class="page-date dt-published" datetime="2017-11-30T00:00:00+08:00"><a class="u-url" href="">November 30, 2017</a>
</time>

  </div>
</div>

        
  <h3 class="page-taxonomies-title">Categories</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy">Learning Notes</li><li class="page-taxonomy">Programming</li>
  </ul>


        
  <h3 class="page-taxonomies-title">Tags</h3>
  <ul class="page-taxonomies"><li class="page-taxonomy">Ruby & Rails</li><li class="page-taxonomy">Notes of Rubyist</li>
  </ul>


      </div>

      <div class="page-content">
        <div class="e-content">
          <p>This chapter covers
Â </p>
<ul>
  <li>
    <p>Keyboard input and screen output
é”®ç›˜è¾“å…¥ä¸å±å¹•è¾“å‡º</p>
  </li>
  <li>
    <p>The IO and File classes
IO ä¸ File ç±»</p>
  </li>
  <li>
    <p>Standard library file facilities, including FileUtils and Pathname
standard library ä¸­çš„æ–‡ä»¶å¤„ç†åŠŸèƒ½ï¼ŒåŒ…è£¹ FileUtils å’Œ Pathname</p>
  </li>
  <li>
    <p>The StringIO and open-uri library features
StringIO ä¸ open-uri åº“</p>
  </li>
</ul>

<p>As youâ€™ll see once you dive in, Ruby keeps even file and I/O operations object-oriented. Input and output streams, like the standard input stream or, for that matter, any file handle, are objects. Some I/O-related commands are more procedural: puts, for example, or the system method that lets you execute a system command. But puts is only procedural when itâ€™s operating on the standard output stream. When you puts a line to a file, you explicitly send the message â€œputsâ€ to a File object.</p>

<p>éšç€å­¦ä¹ çš„æ·±å…¥ï¼Œæˆ‘ä»¬ä¼šå‘ç° ruby çš„ æ–‡ä»¶å±‚é¢ å’Œ I / O æ“ä½œ éƒ½æ˜¯é¢å‘å¯¹è±¡é£æ ¼çš„ã€‚è¾“å…¥å’Œè¾“å‡ºæµï¼Œæ¯”å¦‚æ ‡å‡†çš„è¾“å‡ºæµæˆ–è€…è¯´ä»»ä½•çš„æ–‡ä»¶æ“ä½œéƒ½æ˜¯å¯¹è±¡ã€‚æœ‰äº› I / O ç›¸å…³çš„å‘½ä»¤æ›´åŠ å…·æœ‰ç¨‹åºæ€§ï¼š æ¯”å¦‚è¯´ puts , æˆ–è€…ç³»ç»Ÿç›¸å…³çš„method ã€‚ ä½†æ˜¯ puts åªåœ¨å®ƒä½œä¸ºæ ‡å‡†è¾“å‡ºæµæ—¶è¡¨ç°å‡ºè¿™ç§ç¨‹åºæ€§ã€‚å½“ä½ å¯¹ä¸€ä¸ª æ–‡ä»¶file puts ä¸€è¡Œå†…å®¹æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨ ç”¨ puts é€å‡ºä¸€è¡Œ message ç»™ä¸€ä¸ª File å¯¹è±¡ã€‚</p>

<p>The memory space of a Ruby program is a kind of idealized space, where objects come into existence and talk to each other. Given the fact that I/O and system command execution involve stepping outside this idealized space, Ruby does a lot to keep objects in the mix.</p>

<p>Rubyç¨‹å¼çš„è®°å¿†ç©ºé—´ç±»ä¼¼ä¸€ç§ç†æƒ³çš„ç©ºé—´åœºæ‰€ï¼Œobjectså¯ä»¥åœ¨è¿™é‡Œå­˜åœ¨å¹¶ç›¸äº’äº¤è°ˆã€‚  ä½†æ¶‰åŠåˆ° I / O å’Œ ç³»ç»Ÿsystem å±‚é¢çš„æ“ä½œï¼Œä¸å¯é¿å…çš„è¦è¸å‡ºè¿™ä¸ªç†æƒ³çš„ç©ºé—´ï¼Œ ruby ä¸ºäº†åœ¨è¿™ç§æƒ…å†µä¸‹ä¿æŒé¢å‘å¯¹è±¡æ€§åšå‡ºäº†å¾ˆå¤šåŠªåŠ›ã€‚</p>

<p>Youâ€™ll see more discussion of standard library (as opposed to core) packages in this chapter than anywhere else in the book. Thatâ€™s because the file-handling facilities in the standard libraryâ€”highlighted by the FileUtils, Pathname, and StringIO packagesâ€”are so powerful and so versatile that theyâ€™ve achieved a kind of quasi-core status. The odds are that if you do any kind of file-intensive Ruby programming, youâ€™ll get to the point where you load those packages almost without thinking about it.</p>

<p>åœ¨è¿™ç« é‡Œï¼Œä½ ä¼šæ¯”åœ¨ä¹¦ä¸­å…¶ä»–åœ°æ–¹æ›´å¤šåœ°çœ‹åˆ° å…³äº standard library çš„è®¨è®ºã€‚è¿™æ˜¯å› ä¸º FileUtils, Pathname , StringIO è¿™äº›åº“æ‰€æä¾›çš„å…³äºæ–‡ä»¶å±‚é¢çš„æ“ä½œæ˜¯ååˆ†å¼ºå¤§çš„ï¼Œå…¶ç”¨é€”æ¥è¿‘å‡†core çš„ç¨‹åº¦ã€‚æ›´å¤šçš„å¯èƒ½æ€§æ˜¯å¦‚æœä½ ä¼šåœ¨ä½ çš„rubyç¨‹åºä¸­é¢‘ç¹ç”¨åˆ°æ–‡ä»¶å±‚é¢çš„æ“ä½œï¼Œé‚£ä¹ˆä½ å‡ ä¹æƒ³ä¹Ÿä¸ä¼šæƒ³çš„å°±å¼•å…¥è¿™äº›ç›¸å…³çš„åº“ã€‚</p>

<p>-</p>

<p><strong>How Rubyâ€™s I / O systems is put together</strong>
Ruby I/O ç³»ç»Ÿæ˜¯å¦‚ä½•æ„æˆçš„</p>

<p>-</p>

<p>The IO class handles all input and output streams either by itself or via its descendant classes, particularly File. To a large extent, IOâ€™s API consists of wrappers around system library calls, with some enhancements and modifications. The more familiar you are with the C standard library, the more at home youâ€™ll feel with methods like seek, getc, and eof?. Likewise, if youâ€™ve used another high-level language that also has a fairly close-fitting wrapper API around those library methods, youâ€™ll recognize their equivalents in Ruby. But even if youâ€™re not a systems or C programmer, youâ€™ll get the hang of it quickly.</p>

<p><code class="highlighter-rouge">class IO</code> æˆ–è€…ä»–çš„å­ç±»ç‰¹åˆ«æ˜¯ <code class="highlighter-rouge">class File</code> è´Ÿè´£å¤„ç†æ‰€æœ‰çš„è¾“å…¥è¾“å‡ºæµã€‚å¤§èŒƒå›´ä¸Šçœ‹ï¼Œ IO çš„APIä»ç³»ç»Ÿå±‚é¢å€Ÿç”¨äº†å¾ˆå¤šä¸œè¥¿ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›ä¿®æ”¹å’Œæå‡ã€‚å¦‚æœä½ å¯¹ <a href="https://en.wikipedia.org/wiki/C_standard_library">C standard library</a>å¾ˆç†Ÿæ‚‰çš„è¯ä½ å°±ä¼šå‘ç°è·Ÿ <code class="highlighter-rouge">seek</code>, <code class="highlighter-rouge">getc</code>, <code class="highlighter-rouge">eof?</code> è¿™äº›æ–¹æ³•å¾ˆç†Ÿæ‚‰ã€‚ ä½†å¦‚æœä½ ä½¿ç”¨çš„å¦ä¸€ç§é«˜çº§è¯­è¨€ä½†åŒæ ·ä½¿ç”¨çš„æ˜¯ä»libcä¸­å€Ÿç”¨çš„æ–¹æ³•ï¼Œä½ ä¼šå‘ç°ä»–ä»¬å’Œ ruby ä¸­å¯¹åº”çš„æ–¹æ³•å¾ˆç›¸ä¼¼ã€‚ ä½†æ˜¯å³ä½¿ä½ ä¸æ˜¯ä¸€ä¸ªç³»ç»Ÿå¼€å‘è€…æˆ–è€…Cè¯­è¨€ä½¿ç”¨è€…ï¼Œä½ ä¹Ÿä¼šå¾ˆå¿«ä¸Šæ‰‹ã€‚</p>

<p>-</p>

<p><strong>The IO class</strong></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">ancestors</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="no">File</span><span class="p">,</span> <span class="no">IO</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">Constants</span><span class="p">,</span> <span class="no">Enumerable</span><span class="p">,</span> <span class="no">Object</span><span class="p">,</span> <span class="no">Kernel</span><span class="p">,</span> <span class="no">BasicObject</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>IO objects ä»£è¡¨å¯è¯»æˆ–å¯å†™çš„ï¼Œä¸ç£ç›˜ï¼Œé”®ç›˜ï¼Œå±å¹•ä»¥åŠå…¶ä»–è®¾å¤‡çš„<strong>è¿æ¥</strong>ã€‚ä½ å¯ä»¥åƒå¯¹å¾…å…¶ä»– object é‚£æ ·å¯¹å¾…ä»–ï¼Œå‘å®ƒé€å‡ºä¿¡æ¯ï¼Œç„¶åä»–return å€¼ç»™ä½ ã€‚</p>

<p>å½“ä¸€ä¸ªrubyç¨‹åºå¼€å§‹è¿è¡Œæ—¶ï¼Œ å®ƒå°±æ˜ç™½ä»€ä¹ˆæ˜¯ æ ‡å‡†è¾“ å…¥ä¸ è¾“å‡º ä»¥åŠ é”™è¯¯æµã€‚ è¿™ä¸‰ç§æµéƒ½è¢«å°è£…åœ¨ IO çš„å®ä¾‹instanceså½“ä¸­ã€‚</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="no">STDERR</span><span class="p">.</span><span class="nf">class</span>
 <span class="o">=&gt;</span> <span class="no">IO</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="no">STDERR</span><span class="p">.</span><span class="nf">puts</span> <span class="s1">'Problem!'</span>
<span class="no">Problem</span><span class="o">!</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="no">STDERR</span><span class="p">.</span><span class="nf">write</span> <span class="s1">'Problem!\n'</span>
<span class="no">Problem</span><span class="o">!</span><span class="p">\</span><span class="n">n</span> <span class="o">=&gt;</span> <span class="mi">10</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>STDERR - standard error</p>

<p>STDIN - standard input</p>

<p>STDOUT - standard output</p>

<p>è¿™æ˜¯ä¸‰ä¸ªå¸¸é‡åªè¦ç¨‹åºä¸€å¼€å§‹å°±å·²ç»è®¾ç½®å¥½äº†ã€‚STDERRæ˜¯ä¸€ä¸ª IO object. å¦‚æœä¸€ä¸ª IO object è¢«æ‰“å¼€ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ puts æ¥å‘ä»–å†™å…¥ä¿¡æ¯ï¼Œæ— è®ºä½ é€å‡ºä»€ä¹ˆä¿¡æ¯éƒ½ä¼šå†™åˆ° è¿™ä¸ª IO object çš„è¾“å‡ºæµä¸­ã€‚</p>

<p>é™¤äº† puts , IO objects è¿˜æœ‰ print å’Œ write æ–¹æ³•ã€‚å¦‚æœä½  write ä¿¡æ¯ç»™ä¸€ä¸ª IO object, ä¸ä¼šå‡ºç°è‡ªåŠ¨æ¢è¡Œçš„è¾“å‡ºï¼Œä¼šåœ¨ä½ å†™å…¥çš„ä¿¡æ¯åè·Ÿä¸Šä¿¡æ¯çš„é•¿åº¦ã€‚</p>

<p>IO ä½œä¸ºä¸€ä¸ª ruby class , å¾ˆè‡ªç„¶åœ°ä¼š æ··å…¥ module, å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ··å…¥äº† Enumerable module, å› æ­¤ IO object æ˜¯å¯ä»¥æšä¸¾çš„ã€‚</p>

<p>-</p>

<p><strong>IO objects as enumerables</strong>
ä½œä¸ºå¯æšä¸¾å¯¹è±¡çš„IO objects</p>

<p>-</p>

<p>An enumerable, as you know, must have an each method so that it can iterate. IO objects iterate based on the global input record separator, which, as you saw in connection with strings and their each_line method in section 10.7, is stored in the global variable $/.
å¦‚æˆ‘ä»¬ä¹‹é—´æåˆ°çš„ï¼Œä¸€ä¸ªå¯æšä¸¾çš„å¯¹è±¡ï¼Œå¿…é¡»æœ‰è‡ªå·±çš„<code class="highlighter-rouge">each</code>é€»è¾‘ï¼Œä»–æ‰èƒ½è¿›è¡Œè¿­ä»£æ“ä½œã€‚ IOå¯¹è±¡çš„è¿­ä»£æ“ä½œåŸºäºå…¨åŸŸçš„è¾“å…¥åˆ†éš”ç¬¦ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰æˆ‘ä»¬åœ¨å¯¹stringä½¿ç”¨<code class="highlighter-rouge">each_line</code>æ—¶çœ‹åˆ°çš„ <code class="highlighter-rouge">$/</code> ä¹Ÿå°±æ˜¯æ¢è¡Œç¬¦å·ã€‚</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">006</span> <span class="o">&gt;</span> <span class="vg">$/</span>
 <span class="o">=&gt;</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span> <span class="no">STDIN</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;IO:&lt;STDIN&gt;&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="no">STDIN</span><span class="p">.</span><span class="nf">object_id</span>
 <span class="o">=&gt;</span> <span class="mi">70200548658380</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="no">STDIN</span><span class="p">.</span><span class="nf">object_id</span>
 <span class="o">=&gt;</span> <span class="mi">70200548658380</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">010</span> <span class="o">&gt;</span> <span class="no">STDIN</span><span class="p">.</span><span class="nf">object_id</span>
 <span class="o">=&gt;</span> <span class="mi">70200548658380</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">011</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>STDIN ä½œä¸ºconstant ä»–çš„idä¸å˜ï¼Œä½†å¯ä»¥çœ‹åˆ°å®ƒæ˜¯ IO çš„å®ä¾‹å¯¹è±¡</p>

<p>In the following examples, Rubyâ€™s output is indicated by bold type; regular type indicates keyboard input. The code performs an iteration on STDIN, the standard input stream. (Weâ€™ll look more closely at STDIN and friends in the next section.) At first, STDIN treats the newline character as the signal that one iteration has finished; it thus prints each line as you enter it:</p>

<p>ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†ä¸€æ¬¡å¯¹ STDIN çš„è¿­ä»£æ“ä½œï¼Œä¹Ÿå°±æ˜¯standard inputæµã€‚é¦–å…ˆ STDIN ä¼šæŠŠæ¢è¡Œç¬¦å·ä½œä¸ºä¸€æ­¥è¿­ä»£çš„ç»“æŸæ ‡å¿—ï¼Œè¿™æ ·ä»–å°å‡ºçš„å°±å’Œä½ å½“åˆè¾“å…¥çš„ç›¸åŒï¼š</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">013</span> <span class="o">&gt;</span> <span class="no">STDIN</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="nb">p</span> <span class="n">line</span> <span class="p">}</span>
<span class="no">This</span> <span class="n">is</span> <span class="n">line</span> <span class="mi">1</span>
<span class="s2">"This is line 1</span><span class="se">\n</span><span class="s2">"</span>
<span class="no">This</span> <span class="n">is</span> <span class="n">line</span> <span class="mi">2</span>
<span class="s2">"This is line 2</span><span class="se">\n</span><span class="s2">"</span>
<span class="no">All</span> <span class="n">seperated</span> <span class="n">by</span> <span class="vg">$/</span><span class="p">,</span> <span class="n">which</span> <span class="n">is</span> <span class="n">a</span> <span class="n">newline</span> <span class="n">character</span>
<span class="s2">"All seperated by $/, which is a newline character</span><span class="se">\n</span><span class="s2">"</span>
</code></pre></div></div>

<p>æ­£å¸¸æƒ…å†µä¸‹ruby åœ¨è¿›è¡Œ STDIN çš„iteration æ“ä½œæ—¶ï¼Œæ¯æ¬¡é”®å…¥ å›è½¦é”® éƒ½ä¼šè¢«è¯†åˆ«ä¸º line çš„åˆ†éš”æ ‡å¿—</p>

<p>ä½†å¦‚æœæˆ‘ä»¬åƒä¸Šæ¬¡ä¸€æ ·æŠŠ $/ çš„å€¼æ”¹ä¸€ä¸‹  æ”¹æˆå­—ä¸² â€œNEXTâ€</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="vg">$/</span>
 <span class="o">=&gt;</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="vg">$/</span> <span class="o">=</span> <span class="s2">"-NEXT-"</span>
 <span class="o">=&gt;</span> <span class="s2">"-NEXT-"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span> <span class="no">STDIN</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="nb">p</span> <span class="n">line</span> <span class="p">}</span>
<span class="no">This</span> <span class="n">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">line</span><span class="o">.</span>  <span class="c1"># entered return button</span>
                         <span class="c1"># entered return button</span>
                         <span class="c1"># entered return button</span>
<span class="no">This</span> <span class="n">is</span> <span class="n">the</span> <span class="n">fourth</span> <span class="n">line</span><span class="o">.</span>
<span class="no">Until</span> <span class="no">I</span> <span class="n">write</span> <span class="o">-</span><span class="no">NEXT</span><span class="o">-</span>
<span class="s2">"This is the first line.</span><span class="se">\n\n\n</span><span class="s2">This is the fourth line.</span><span class="se">\n</span><span class="s2">Until I write -NEXT-"</span>
</code></pre></div></div>

<p>æ³¨æ„ä¸­é—´çš„çš„ä¸¤ä¸ªç©ºè¡ŒåŠ ä¸Šç¬¬ä¸€è¡Œæœ«å°¾çš„æ¢è¡Œç¬¦å·ï¼Œè™½ç„¶æ¯ä¸€æ¬¡æ¢è¡Œéƒ½å‘å­—ä¸²ä¸­åŠ å…¥äº†ä¸€ä¸ª <code class="highlighter-rouge">\n</code> ä½†rubyå·²ç»ä¸å†æŠŠä»–ä½œä¸ºæº¢å‡ºçš„æ¢è¡Œæ ‡å¿—ï¼Œè€Œæˆä¸ºäº†å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œåªæœ‰å½“ä½ æ‰‹åŠ¨è¾“å…¥ <code class="highlighter-rouge">-NEXT-</code> æ—¶ï¼Œå®é™…æ¢è¡Œæ‰ä¼šå‘ç”Ÿï¼Œä¹‹å‰æ‰€æœ‰çš„å†…å®¹æ‰ä¼šè¢«ä½œä¸ºä¸€è¡Œæ¥è§£è¯»ï¼Œè™½ç„¶çœ‹èµ·æ¥æ•²å‡»äº†å¤šæ¬¡å›è½¦ï¼Œä½†å›è½¦åªæ˜¯å‘å†…å®¹ä¸­åŠ å…¥ <code class="highlighter-rouge">/n</code> ï¼Œåœ¨ <code class="highlighter-rouge">$/</code> è¢«ä¿®æ”¹ä»¥åå·²ç»ä¸ä½œä¸ºæ¢è¡Œæ ‡å¿—ã€‚</p>

<p>So $/ determines an IO objectâ€™s sense of â€œeach.â€ And because IO objects are enumerable, you can perform the usual enumerable operations on them. (You can assume that $/ has been returned to its original value in these examples.)</p>

<p>$/ çš„å€¼å†³å®šäº† IO object å…³äº each çš„è®¤è¯†ï¼Œç”±äº IO objects å…·æœ‰å¯æšä¸¾æ€§ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å…¶ä½¿ç”¨å¸¸ç”¨çš„æšä¸¾æ“ä½œã€‚ä¸‹é¢çš„ä¾‹å­ä¸­ $/ çš„å€¼å·²ç»è¢«è¿˜åŸä¸ºé»˜è®¤å€¼</p>

<p>The ^D notation indicates that the typist entered Ctrl-d at that point:</p>

<p>æ•²å‡» control D æ¥å®Œæˆè¾“å…¥</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="no">STDIN</span><span class="p">.</span><span class="nf">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="n">line</span> <span class="o">=~</span> <span class="sr">/\A[A-Z]/</span> <span class="p">}</span>
<span class="no">We</span><span class="s1">'re only interested in
lines that begin with
Uppercase letters.
 =&gt; ["We'</span><span class="n">re</span> <span class="n">only</span> <span class="n">interested</span> <span class="k">in</span><span class="p">\</span><span class="n">n</span><span class="s2">", "</span><span class="no">Uppercase</span> <span class="n">letters</span><span class="o">.</span><span class="p">\</span><span class="n">n</span><span class="s2">"]
2.5.0 :003 &gt; STDIN.map { |line| line.reverse }
senil esehT
terces a niatnoc
.egassem
 =&gt; ["</span><span class="p">\</span><span class="n">nThese</span> <span class="n">lines</span><span class="s2">", "</span><span class="p">\</span><span class="n">ncontain</span> <span class="n">a</span> <span class="n">secret</span><span class="s2">", "</span><span class="p">\</span><span class="n">nmessage</span><span class="o">.</span><span class="s2">"]
2.5.0 :004 &gt;
</span></code></pre></div></div>

<p>â€”-</p>

<p><strong>STDIN, STDOUT, STDERR</strong></p>

<p>STDIN, STDOUT, STDERRå¯¹è±¡
â€”-</p>

<p>If youâ€™ve written programs and/or shell scripts that use any kind of I/O piping, then youâ€™re probably familiar with the concept of the standard input, output, and error streams. Theyâ€™re basically defaults: unless told otherwise, Ruby assumes that all input will come from the keyboard, and all normal output will go to the terminal. Assuming, in this context, means that the unadorned, procedural I/O methods, like puts and gets, operate on STDOUT and STDIN, respectively.
Error messages and STDERR are a little more involved. Nothing goes to STDERR unless someone tells it to. So if you want to use STDERR for output, you have to name it explicitly:</p>

<p>å¦‚æœä½ å·²ç»ä½¿ç”¨è¿‡ I / O ç›¸å…³çš„å‘½ä»¤è¡Œï¼Œä½ åº”è¯¥å¯¹ standard input , output , error ä¸‰ç§ streams æœ‰æ‰€äº†è§£ï¼Œä»–ä»¬éƒ½æ˜¯é»˜è®¤è®¾ç½®ï¼Œé™¤éäººä¸ºè¿›è¡Œå…¶ä»–è®¾ç½®ï¼Œrubyé»˜è®¤æ‰€æœ‰ input éƒ½æ¥è‡ªé”®ç›˜ï¼Œæ‰€æœ‰ output éƒ½è¾“å‡ºåˆ° terminal ç»ˆç«¯ã€‚åœ¨è¿™ç§å‡è®¾ä¸‹ï¼Œ puts å¯¹åº”çš„ STDOUT ï¼Œ gets å¯¹åº”çš„ STDIN ã€‚</p>

<p>é”™è¯¯æµ  STDERR çš„æƒ…å†µç¨å¾®å¤æ‚ä¸€äº›ï¼Œå¦‚æœæ²¡æœ‰é€ä»»ä½•ä¿¡æ¯ç»™å®ƒï¼Œ å®ƒä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºï¼Œé™¤éä½ æ˜ç¡®æŒ‡å®šé”™è¯¯ä¿¡æ¯ç»™ä»–</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">condition</span>
  <span class="no">STDERR</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"There's a problem."</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In addition to the three constants, Ruby also gives you three global variables: $stdin, $stdout, and $stderr.</p>

<p>é™¤äº†ä¸Šé¢æåˆ°çš„ 3 ä¸ªå¸¸é‡å¯¹è±¡ï¼Œ Ruby ä¹Ÿç»™å‡ºäº†ä¸‰ä¸ª global variables</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$stdin
$stdout
$stderr
</code></pre></div></div>

<p>â€”-</p>

<p><strong>The standard I/O global variables</strong></p>

<p>â€”-</p>

<p>$stdin å¯¹åº” STDIN</p>

<p>$stdout  å¯¹åº” STDOUT</p>

<p>$stderr å¯¹åº” STDERR</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="vg">$stdin</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;IO:&lt;STDIN&gt;&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="vg">$stdout</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;IO:&lt;STDOUT&gt;&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span> <span class="vg">$stderr</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;IO:&lt;STDERR&gt;&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">006</span> <span class="o">&gt;</span> <span class="vg">$stdin</span> <span class="o">==</span> <span class="no">STDIN</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span> <span class="vg">$stdout</span> <span class="o">==</span> <span class="no">STDOUT</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="vg">$stderr</span> <span class="o">==</span> <span class="no">STDERR</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre></div></div>

<p>ä¹‹å‰è¯´è¿‡ ruby é»˜è®¤æƒ…å†µä¸‹ä¼šå°†æ‰€æœ‰è¾“å‡ºæŒ‡å‘ terminal</p>

<p>å¦‚æœç°åœ¨æˆ‘ä»¬æƒ³è¦æŠŠæ‰€æœ‰çš„ è¾“å‡º  ä»¥åŠ é”™è¯¯ä¿¡æ¯è¾“å‡º éƒ½å†™è¿›ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹ ä¸Šé¢æåˆ°çš„ $stdout å’Œ $stderr çš„æŒ‡å‘æ¥å®ç°</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="n">new_path</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"./record"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;File:./record&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="n">old_stdout</span> <span class="o">=</span> <span class="vg">$stdout</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;IO:&lt;STDOUT&gt;&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="vg">$stdout</span> <span class="o">=</span> <span class="n">new_path</span>   <span class="c1"># things changed at this moment</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">10</span><span class="o">/</span><span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span> <span class="vg">$stderr</span> <span class="o">=</span> <span class="vg">$stdout</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">006</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="s2">"Now puts method will not show you anything in terminal."</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="s2">"So as an error message"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">10</span><span class="o">/</span><span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">new_path</span><span class="p">.</span><span class="nf">close</span>
</code></pre></div></div>

<p>ä»ç¬¬3è¡Œé‚£é‡Œå¼€å§‹terminal ä¸­ä¸å†å°å‡ºreturnå€¼ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½è¢«è¾“å‡ºåˆ°äº†æŒ‡å®šçš„æ–‡ä»¶å¯¹è±¡ä¸­</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">=&gt;</span> <span class="c1">#&lt;File:./record&gt;   # First stdout after changing path</span>
<span class="err"></span><span class="p">[</span><span class="mi">1</span><span class="n">mTraceback</span><span class="err"></span><span class="p">[</span><span class="n">m</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
       <span class="mi">3</span><span class="p">:</span> <span class="n">from</span> <span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="p">.</span><span class="nf">rvm</span><span class="o">/</span><span class="n">rubies</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">irb</span><span class="p">:</span><span class="mi">11</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;'
       2: from (irb):4
       1: from (irb):4:in `</span><span class="o">/</span><span class="s1">'
[1mZeroDivisionError ([4mdivided by 0[0;1m)[m
=&gt; #&lt;File:./record&gt;
Now puts method will not show you anything in terminal.
=&gt; nil
So as an error message
=&gt; nil
[1mTraceback[m (most recent call last):
       3: from /Users/caven/.rvm/rubies/ruby-2.5.0/bin/irb:11:in `&lt;main&gt;'</span>
       <span class="mi">2</span><span class="p">:</span> <span class="n">from</span> <span class="p">(</span><span class="n">irb</span><span class="p">):</span><span class="mi">8</span>
       <span class="mi">1</span><span class="p">:</span> <span class="n">from</span> <span class="p">(</span><span class="n">irb</span><span class="p">):</span><span class="mi">8</span><span class="ss">:in</span> <span class="sb">`/'
[1mZeroDivisionError ([4mdivided by 0[0;1m)[m
</span></code></pre></div></div>

<p>æ”¹å˜è¾“å‡ºè·¯å¾„åï¼Œæ‰€æœ‰åŸæœ¬åº”è¯¥åœ¨ terminal ä¸­å°å‡ºçš„ä¿¡æ¯éƒ½è½¬è€Œè¾“å‡ºåˆ°äº†æŒ‡å®šçš„è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p>

<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1foccyau1e0j30bz01uaa8.jpg" alt="" /></p>

<p>old_stdout æ˜¯ä¸ºäº†ä¿å­˜åŸå§‹çš„å˜é‡å€¼</p>

<p>$stdout = new_path è®©æ ‡å‡†è¾“å‡ºä¸å†æŒ‡å‘ terminal è€Œæ˜¯æŒ‡å‘ new_path åŒ…å«çš„æ–‡ä»¶å¯¹è±¡</p>

<p>Of course, you can also send standard output to one file and standard error to another. The global variables let you manipulate the streams any way you need to.</p>

<p>å½“ç„¶ï¼Œä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æˆ‘ä»¬ä¹Ÿå¯ä»¥å°† æ ‡å‡†è¾“å‡º å’Œ é”™è¯¯ä¿¡æ¯è¾“å‡º å¯¼å‘ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹</p>

<p>â€”-</p>

<p><strong>A little more about keyboard input</strong></p>

<p>â€”</p>

<p>å…³äºé”®ç›˜è¾“å…¥ï¼Œé”®ç›˜è¾“å…¥çš„å®ç°å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ä½¿ç”¨  gets å’Œ getcï¼Œ getc åªæ‹¿ä¸€ä¸ª character</p>

<p>è¿˜æœ‰ä¸€ç‚¹ä¸åŒçš„æ˜¯</p>

<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨</p>

<p>gets æ‹¿åˆ°ä¸€è¡Œè¾“å…¥å€¼</p>

<p>ä½†æ— æ³•ç›´æ¥ä½¿ç”¨ getc æ‹¿åˆ°å­—ç¬¦è¾“å…¥ï¼Œè€Œå¿…é¡»åŠ ä¸Š STDIN ï¼Œä½¿ç”¨ STDIN.getc</p>

<p>åœ¨ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œè¾“å…¥çš„ä¿¡æ¯éƒ½è¢«ç¼“å­˜äº†ï¼Œæ•²å‡»å›è½¦é”®åï¼Œè¾“å…¥æ‰ä¼šç¡®è®¤ã€‚</p>

<p>If for some reason youâ€™ve got $stdin set to something other than the keyboard, you can still read keyboard input by using STDIN explicitly as the receiver of gets:</p>

<p>åƒä¹‹å‰ç¤ºèŒƒçš„é‚£æ ·ï¼Œå¦‚æœä½ å°† $stdin è®¾ä¸ºäº†å…¶ä»–å€¼ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨ STDIN.gets æ¥å—æ¥è‡ª é”®ç›˜ çš„è¾“å…¥ï¼Œ å³ä½¿ $stdin è¢«ä¿®æ”¹äº†</p>

<p>Assuming youâ€™ve followed the advice in the previous section and done all your standard I/O stream juggling through the use of the global variables rather than the constants, STDIN will still be the keyboard input stream, even if $stdin isnâ€™t.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="nb">gets</span>
<span class="s2">"Using gets to get a line"</span>
 <span class="o">=&gt;</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">Using gets to get a line</span><span class="se">\"\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="n">lines</span>
 <span class="o">=&gt;</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">Using gets to get a line</span><span class="se">\"\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="n">char</span> <span class="o">=</span> <span class="nb">getc</span>
<span class="no">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
        <span class="mi">2</span><span class="p">:</span> <span class="n">from</span> <span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="p">.</span><span class="nf">rvm</span><span class="o">/</span><span class="n">rubies</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">irb</span><span class="p">:</span><span class="mi">11</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;'
        1: from (irb):3
NameError (undefined local variable or method `</span><span class="nb">getc</span><span class="err">'</span> <span class="k">for</span> <span class="n">main</span><span class="ss">:Object</span>
<span class="no">Did</span> <span class="n">you</span> <span class="n">mean?</span>  <span class="nb">gets</span><span class="p">)</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="n">char</span> <span class="o">=</span> <span class="no">STDIN</span><span class="p">.</span><span class="nf">getc</span>
<span class="no">No</span> <span class="n">quotation</span> <span class="n">mark</span> <span class="n">arround</span>
 <span class="o">=&gt;</span> <span class="s2">"N"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span> <span class="n">char</span>
 <span class="o">=&gt;</span> <span class="s2">"N"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">006</span> <span class="o">&gt;</span> <span class="n">char</span> <span class="o">=</span> <span class="no">STDIN</span><span class="p">.</span><span class="nf">getc</span>
 <span class="o">=&gt;</span> <span class="s2">"o"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span> <span class="n">char</span> <span class="o">=</span> <span class="no">STDIN</span><span class="p">.</span><span class="nf">getc</span>
 <span class="o">=&gt;</span> <span class="s2">" "</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">char</span> <span class="o">=</span> <span class="no">STDIN</span><span class="p">.</span><span class="nf">getc</span>
 <span class="o">=&gt;</span> <span class="s2">"q"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>â€”</p>

<p><strong>Basic file operations</strong></p>

<p>â€”</p>

<p>The built-in class File provides the facilities for manipulating files in Ruby. File is a subclass of IO, so File objects share certain properties with IO objects, although the File class adds and changes certain behaviors.</p>

<p>rubyå†…å»ºçš„ File classæä¾›äº†æˆ‘ä»¬æ–‡ä»¶æ“ä½œçš„åŠŸèƒ½ã€‚Fileæ˜¯IOçš„å­ç±»ï¼Œæ‰€ä»¥ File çš„å®ä¾‹å…·æœ‰ç‰¹å®šçš„ IO ç‰¹æ€§ï¼Œå½“ç„¶ File ä¹Ÿæ·»åŠ äº†ä¸€äº›å˜åŒ–ã€‚</p>

<p>Weâ€™ll look first at basic file operations, including opening, reading, writing, and closing files in various modes. Then, weâ€™ll look at a more â€œRubyishâ€ way to handle file reading and writing: with code blocks. After that, weâ€™ll go more deeply into the enumerability of files, and then end the section with an overview of some of the common exceptions and error messages you may get in the course of manipulating files.</p>

<p>æˆ‘ä»¬å°†ä¼šé¦–å…ˆç€çœ¼äºåŸºæœ¬çš„ file æ“ä½œï¼ŒåŒ…æ‹¬ï¼ˆå„ç§æ¨¡å¼ä¸‹çš„ï¼‰ æ‰“å¼€ï¼Œè¯»å–ï¼Œå†™å…¥ï¼Œå…³é—­ ã€‚
æ¥ç€æˆ‘ä»¬å°†ä¼šäº†è§£å¦‚ä½•ä»¥æ›´åŠ  Rubyish çš„æ–¹å¼è¿›è¡Œfileè¯»å†™ï¼šä½¿ç”¨ block ã€‚ æœ€åæˆ‘ä»¬å°†ä¼šæ·±å…¥å…³äº file çš„ enumerability æšä¸¾ç‰¹æ€§çš„å†…å®¹ï¼Œä»¥åŠå¸¸è§çš„è¿›è¡Œæ–‡ä»¶æ“ä½œæ—¶çš„æŠ¥é”™ä¿¡æ¯ã€‚</p>

<p>â€”-</p>

<p>The basics of reading from files</p>

<p>Reading from a file can be performed one byte at a time, a specified number of bytes at a time, or one line at a time (where line is defined by the $/ delimiter). You can also change the position of the next read operation in the file by moving forward or backward a certain number of bytes or by advancing the File objectâ€™s internal pointer to a specific byte offset in the file.</p>

<p>æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡åªè¯»å–æ–‡ä»¶ä¸­ä¸€ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Œæˆ–æŒ‡å®šé•¿åº¦çš„å†…å®¹ï¼Œæˆ–è€…ä¸€æ¬¡ä¸€è¡Œï¼ˆä¾èµ–äº$/ä½œä¸ºåˆ†éš”ç¬¦ï¼‰ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¹å˜è¯»å–çš„æŒ‡é’ˆï¼Œå‘å‰æˆ–å‘åç§»åŠ¨æŒ‡å®šä¸ªå­—ç¬¦çš„ä½ç½®ã€‚</p>

<p>æ–°å»ºä¸€ä¸ª File å®ä¾‹çš„æœ€ç›´è§‚æ–¹æ³•æ˜¯ä½¿ç”¨ File.new</p>

<p>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†ä¼šæŠ¥é”™</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">010</span> <span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'/rubyist/nonexist.rb'</span><span class="p">)</span>
<span class="no">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
        <span class="mi">4</span><span class="p">:</span> <span class="n">from</span> <span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="p">.</span><span class="nf">rvm</span><span class="o">/</span><span class="n">rubies</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">irb</span><span class="p">:</span><span class="mi">11</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;'
        3: from (irb):10
        2: from (irb):10:in `</span><span class="n">new</span><span class="s1">'
        1: from (irb):10:in `initialize'</span>
<span class="no">Errno</span><span class="o">::</span><span class="no">ENOENT</span> <span class="p">(</span><span class="no">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span> <span class="err">@</span> <span class="n">rb_sysopen</span> <span class="o">-</span> <span class="sr">/rubyist/nonexis</span><span class="n">t</span><span class="p">.</span><span class="nf">rb</span><span class="p">)</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">011</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>With no associated block, File.open is a synonym for ::new. If the optional code block is given, it will be passed the opened file as an argument and the File object will automatically be closed when the block terminates. The value of the block will be returned from File.open.</p>

<p>If a file is being created, its initial permissions may be set using the perm parameter. See ::new for further discussion.</p>

<p>å¦‚æœæ²¡æœ‰ç»™å‡ºå…³è”çš„ blockï¼Œ File.open å’Œ File.new æ˜¯åŒä¹‰çš„ã€‚å¦‚æœç»™å‡ºçš„ blockï¼Œé‚£ä¹ˆfileå¯¹è±¡å°†ä¼šä½œä¸º parameter argument ä¼ å…¥ blockï¼Œåœ¨blockæ‰§è¡Œå®Œæˆåï¼Œæ–‡ä»¶å¯¹è±¡å°†è‡ªåŠ¨æ‰§è¡Œ close åŠ¨ä½œä¸å†éœ€è¦æ‰‹åŠ¨æ‰§è¡Œã€‚</p>

<p>å‡è®¾ file å·²ç»å­˜åœ¨ï¼Œä½ å°†å¾—åˆ°ä¸€ä¸ªå¯è¯»çš„æ–‡ä»¶</p>

<p>ç°åœ¨æœ‰è¿™ä¸ªæ–‡ä»¶ /rubyist/code/ticket2.rb</p>

<p>ä½¿ç”¨ File.new(#file_path) æ‹¿åˆ°è¿™ä¸ª æ–‡ä»¶å¯¹è±¡ åï¼Œæœ‰å¾ˆå¤šmethod å¯ä»¥è¾“å‡ºæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œæ¯”å¦‚ä½¿ç”¨ read, ä¼šä»¥ä¸€è¡Œå­—ä¸²çš„æ ¼å¼è¾“å‡ºæ–‡ä»¶å†…å®¹</p>

<p>(If the file doesnâ€™t exist, an exception will be raised.) At this point, you can use the file instance to read from the file. A number of methods are at your disposal. The absolute simplest is the read method; it reads in the entire file as a single string:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/ticket2.rb'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;File:/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/ticket2.rb&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span>
 <span class="o">=&gt;</span> <span class="s2">"class Ticket</span><span class="se">\n</span><span class="s2">  def initialize(venue, date)</span><span class="se">\n</span><span class="s2">    @venue = venue</span><span class="se">\n</span><span class="s2">    @date = date</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def price=(price)</span><span class="se">\n</span><span class="s2">    @price = price</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def venue</span><span class="se">\n</span><span class="s2">    @venue</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def date</span><span class="se">\n</span><span class="s2">    @date</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def price</span><span class="se">\n</span><span class="s2">    @price</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n</span><span class="s2">end</span><span class="se">\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">006</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>at your disposal
ä»»æ„ä½¿ç”¨ï¼›ä»»ä½ è‡ªç”±æ”¯é…ï¼›å¬ä½ å·®é£</p>

<p>è¿™æ˜¯ ticket2.rb ä¸­åŸæœ¬çš„å†…å®¹</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Ticket</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">venue</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
    <span class="vi">@venue</span> <span class="o">=</span> <span class="n">venue</span>
    <span class="vi">@date</span> <span class="o">=</span> <span class="n">date</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">price</span><span class="o">=</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
    <span class="vi">@price</span> <span class="o">=</span> <span class="n">price</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">venue</span>
    <span class="vi">@venue</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">date</span>
    <span class="vi">@date</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">price</span>
    <span class="vi">@price</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Although using read is tempting in many situations and appropriate in some, it can be inefficient and a bit sledgehammer-like when you need more granularity in your data reading and processing.
Weâ€™ll look here at a large selection of Rubyâ€™s file-reading methods, handling them in groups: first line-based read methods and then byte-based read methods.</p>

<p>è™½ç„¶ .read å¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒä¸èƒ½æä¾›å¾ˆå¥½çš„è¾“å‡ºç»“æ„ï¼Œä¸‹é¢ä¼šè®²åˆ°ä¸€äº›æ–‡ä»¶è¯»å–æ–¹æ³•ï¼Œæœ‰åŸºäº line çš„ï¼Œæœ‰åŸºäº å­—èŠ‚ çš„ã€‚</p>

<p>â€”-</p>

<p>Close your file handles</p>

<p>â€”-
When youâ€™re finished reading from and/or writing to a file, you need to close it. File objects have a close method (for example, f.close) for this purpose. Youâ€™ll learn about a way to open files so that Ruby handles the file closing for you, by scoping the whole file operation to a code block. But if youâ€™re doing it the old-fashioned way, as in the examples involving File.new in this part of the chapter, you should close your files explicitly. (Theyâ€™ll get closed when you exit irb too, but itâ€™s good practice to close the ones youâ€™ve opened.)</p>

<p>å½“æˆ‘ä»¬ è¯»å®Œ æˆ–è€… å†™å®Œ ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä½ éœ€è¦å…³é—­ä»–ã€‚ File å¯¹è±¡æœ‰ close æ–¹æ³•æ¥å®Œæˆï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨ f.closeã€‚ æˆ‘ä»¬å°†ä¼šæåˆ°ä½¿ç”¨ block æ¥å¤„ç†æ–‡ä»¶ ruby ä¼šè‡ªåŠ¨å¸®ä½  å…³é—­ æ–‡ä»¶ã€‚ä½†å¦‚æœä½ åçˆ±ä½¿ç”¨ File.new è¿™ç§æ–¹å¼ï¼Œè®°å¾—è¦å…³é—­ï¼Œè™½ç„¶åœ¨æˆ‘ä»¬é€€å‡º irb åï¼Œ ruby ä¹Ÿä¼šè‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼Œä½†æ˜¯ä¸»åŠ¨è®°å¾—åœ¨ç¼–è¾‘åå…³é—­ä»»ç„¶æ˜¯å¥½ä¹ æƒ¯ã€‚</p>

<p>â€”-</p>

<p><strong>Line-based file reading</strong></p>

<p>åŸºäº è¡Œ çš„æ–‡ä»¶è¯»å–</p>

<p>â€”-</p>

<p>gets  æ–¹æ³•è¯»å–æ–‡ä»¶ä¸­çš„ä¸‹ä¸€è¡Œ</p>

<p>readlineä¹Ÿå¯ä»¥è¯»ä¸‹ä¸€è¡Œï¼Œå®ƒå’Œ gets çš„åŒºåˆ«åœ¨äºï¼Œ gets è¯»åˆ°æ–‡ä»¶æœ«å°¾æ—¶è¿”å› nil, å‰è€…åˆ™ä¼šæŠ¥é”™ fatal error</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">gets</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">rewind</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span>
 <span class="o">=&gt;</span> <span class="s2">"class Ticket</span><span class="se">\n</span><span class="s2">  def initialize(venue, date)</span><span class="se">\n</span><span class="s2">    @venue = venue</span><span class="se">\n</span><span class="s2">    @date = date</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def price=(price)</span><span class="se">\n</span><span class="s2">    @price = price</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def venue</span><span class="se">\n</span><span class="s2">    @venue</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def date</span><span class="se">\n</span><span class="s2">    @date</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def price</span><span class="se">\n</span><span class="s2">    @price</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n</span><span class="s2">end</span><span class="se">\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">010</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">gets</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">011</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">readline</span>
<span class="no">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
        <span class="mi">3</span><span class="p">:</span> <span class="n">from</span> <span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="p">.</span><span class="nf">rvm</span><span class="o">/</span><span class="n">rubies</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">irb</span><span class="p">:</span><span class="mi">11</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;'
        2: from (irb):11
        1: from (irb):11:in `</span><span class="nb">readline</span><span class="err">'</span>
<span class="no">EOFError</span> <span class="p">(</span><span class="k">end</span> <span class="n">of</span> <span class="n">file</span> <span class="n">reached</span><span class="p">)</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">012</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>å‰é¢å¯¹ f å¯¹è±¡ä½¿ç”¨äº† read è¯»å®Œäº†æ•´ä¸ªæ–‡ä»¶ï¼ŒæŒ‡é’ˆå·²ç»åˆ°äº†æœ«å°¾ï¼Œæ‰€ä»¥getsä¼šæ˜¯nilï¼Œ fileå¯¹è±¡ä¹Ÿæœ‰ rewind å€’å¸¦æ–¹æ³•</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">012</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">rewind</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">013</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">gets</span>
 <span class="o">=&gt;</span> <span class="s2">"class Ticket</span><span class="se">\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">014</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">gets</span>
 <span class="o">=&gt;</span> <span class="s2">"  def initialize(venue, date)</span><span class="se">\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">015</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">readline</span>
 <span class="o">=&gt;</span> <span class="s2">"    @venue = venue</span><span class="se">\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">016</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>If you want to get the entire file at once as an array of lines, use readlines (a close relative of read). Note also the rewind operation, which moves the File objectâ€™s internal position pointer back to the beginning of the file:</p>

<p>readlines(æ³¨æ„å¤æ•°)å¯ä»¥ä¸€æ¬¡å°†æ‰€æœ‰è¡Œæ”¾å…¥ä¸€ä¸ª array ä¸€è¡Œå°±æ˜¯ä¸€ä¸ª element</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">016</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">readlines</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"    @date = date</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  end</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  def price=(price)</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"    @price = price</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  end</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  def venue</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"    @venue</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  end</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  def date</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"    @date</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  end</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  def price</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"    @price</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  end</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"end</span><span class="se">\n</span><span class="s2">"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">017</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">readlines</span><span class="p">.</span><span class="nf">class</span>
 <span class="o">=&gt;</span> <span class="no">Array</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">01</span><span class="mi">8</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>Keep in mind that File objects are enumerable. That means you can iterate through the lines one at a time rather than reading the whole file into memory. The each method of File objects (also known by the synonym each_line) serves this purpose:</p>

<p>ä¸è¦å¿˜è®° File å¯¹è±¡å…·æœ‰å¯æšä¸¾æ€§ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä¸€æ­¥ä¸€æ­¥è¿›è¡Œè¿­ä»£æ“ä½œï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½è¦ä¸€æ¬¡æ€§è¯»å®Œä¸€ä¸ªæ–‡ä»¶ã€‚ ä½¿ç”¨ File class ä¸­çš„ each æˆ–è€… each_line å°±å¯ä»¥è¾¾åˆ°è¿™ä¸ªç›®çš„</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">01</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">rewind</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">020</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"Next line is: </span><span class="si">#{</span><span class="n">line</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is: </span><span class="k">class</span> <span class="nc">Ticket</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:   </span><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">venue</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:     </span><span class="vi">@venue</span> <span class="o">=</span> <span class="n">venue</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:     </span><span class="vi">@date</span> <span class="o">=</span> <span class="n">date</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:   </span><span class="k">end</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:
</span><span class="no">Next</span> <span class="n">line</span> <span class="ss">is:   </span><span class="k">def</span> <span class="nf">price</span><span class="o">=</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:     </span><span class="vi">@price</span> <span class="o">=</span> <span class="n">price</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:   </span><span class="k">end</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:
</span><span class="no">Next</span> <span class="n">line</span> <span class="ss">is:   </span><span class="k">def</span> <span class="nf">venue</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:     </span><span class="vi">@venue</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:   </span><span class="k">end</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:
</span><span class="no">Next</span> <span class="n">line</span> <span class="ss">is:   </span><span class="k">def</span> <span class="nf">date</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:     </span><span class="vi">@date</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:   </span><span class="k">end</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:
</span><span class="no">Next</span> <span class="n">line</span> <span class="ss">is:   </span><span class="k">def</span> <span class="nf">price</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:     </span><span class="vi">@price</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is:   </span><span class="k">end</span>
<span class="no">Next</span> <span class="n">line</span> <span class="ss">is: </span><span class="k">end</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;File:/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/ticket2.rb&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">021</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>-</p>

<p><strong>Byte- and character-based file reading</strong></p>

<p>å­—èŠ‚ ä»¥åŠ å­—ç¬¦ç²’åº¦çš„ file è¯»å–</p>

<p>-</p>

<p>f.getc å¯ä»¥æ‹¿åˆ°ä¸‹ä¸€ä¸ª character å­—ç¬¦</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">023</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">rewind</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">024</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">getc</span>
 <span class="o">=&gt;</span> <span class="s2">"c"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">025</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">ungetc</span><span class="p">(</span><span class="s2">"X"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">026</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">gets</span>
 <span class="o">=&gt;</span> <span class="s2">"Xlass Ticket</span><span class="se">\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">027</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>ungetc ä¼šé€åˆ°ç»™å®šå­—ç¬¦ç»™ä¹‹å‰çš„é‚£ä¸ªä½ç½®ï¼Œè¿™éƒ¨åˆ†å˜åŒ–çš„å†…å®¹ä¼šå­˜åœ¨ç¼“å­˜ä¸­
ä¸ä¼šå¯¹æ–‡ä»¶å†…å®¹æœ¬èº«æœ‰æ”¹å˜</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">ungetc</span>

<span class="p">(</span><span class="n">from</span> <span class="n">ruby</span> <span class="n">site</span><span class="p">)</span>
<span class="o">===</span> <span class="no">Implementation</span> <span class="n">from</span> <span class="no">IO</span>
<span class="o">------------------------------------------------------------------------------</span>
  <span class="n">ios</span><span class="p">.</span><span class="nf">ungetc</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>   <span class="o">-&gt;</span> <span class="kp">nil</span>

<span class="o">------------------------------------------------------------------------------</span>

<span class="no">Pushes</span> <span class="n">back</span> <span class="n">one</span> <span class="n">character</span> <span class="p">(</span><span class="n">passed</span> <span class="n">as</span> <span class="n">a</span> <span class="n">parameter</span><span class="p">)</span> <span class="n">onto</span> <span class="n">ios</span><span class="p">,</span> <span class="n">such</span> <span class="n">that</span> <span class="n">a</span>
<span class="n">subsequent</span> <span class="n">buffered</span> <span class="n">character</span> <span class="n">read</span> <span class="n">will</span> <span class="k">return</span> <span class="n">it</span><span class="o">.</span> <span class="no">Only</span> <span class="n">one</span> <span class="n">character</span> <span class="n">may</span> <span class="n">be</span>
<span class="n">pushed</span> <span class="n">back</span> <span class="n">before</span> <span class="n">a</span> <span class="n">subsequent</span> <span class="n">read</span> <span class="n">operation</span> <span class="p">(</span><span class="n">that</span> <span class="n">is</span><span class="p">,</span> <span class="n">you</span> <span class="n">will</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span>
<span class="n">read</span> <span class="n">only</span> <span class="n">the</span> <span class="n">last</span> <span class="n">of</span> <span class="n">several</span> <span class="n">characters</span> <span class="n">that</span> <span class="n">have</span> <span class="n">been</span> <span class="n">pushed</span> <span class="n">back</span><span class="p">)</span><span class="o">.</span> <span class="no">Has</span> <span class="n">no</span>
<span class="n">effect</span> <span class="n">with</span> <span class="n">unbuffered</span> <span class="n">reads</span> <span class="p">(</span><span class="n">such</span> <span class="n">as</span> <span class="no">IO</span><span class="c1">#sysread).</span>

  <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"testfile"</span><span class="p">)</span>   <span class="c1">#=&gt; #&lt;File:testfile&gt;</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">getc</span>                 <span class="c1">#=&gt; "8"</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">ungetc</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>                <span class="c1">#=&gt; nil</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">getc</span>                     <span class="c1">#=&gt; "8"</span>


<span class="p">(</span><span class="k">END</span><span class="p">)</span>
</code></pre></div></div>
<p>Every character is represented by one or more bytes. How bytes map to characters depends on the encoding. Whatever the encoding, you can move byte-wise as well as character-wise through a file, using getbyte. Depending on the encoding, the number of bytes and the number of characters in your file may or may not be equal, and getc and getbyte, at a given position in the file, may or may not return the same thing.</p>

<p>æ¯ä¸€ä¸ªå­—ç¬¦ character å ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚ï¼Œè¿™å–å†³äºå½“å‰å­—ç¬¦é›†ä½¿ç”¨çš„ç¼–ç ã€‚ä¸ç®¡æ˜¯ä»€ä¹ˆç¼–ç ï¼Œrubyä¸­éƒ½å¯ä»¥è¿›è¡Œå­—èŠ‚ç²’åº¦ä¸Šçš„æ“ä½œï¼Œä»¥æŸä¸€ä¸ªæŒ‡é’ˆä½ç½®ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä¸€ä¸ªå­—èŠ‚çš„å†…å®¹å’Œ ä¸€ä¸ªå­—ç¬¦çš„å†…å®¹ å¯èƒ½æ˜¯ä¸€æ ·çš„ ä¹Ÿå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">032</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">readchar</span>
 <span class="o">=&gt;</span> <span class="s2">"d"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">033</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">readbyte</span>
 <span class="o">=&gt;</span> <span class="mi">101</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">034</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>readchar  å’Œ readbyte åœ¨è¯»åˆ°æ–‡ä»¶å¯¹è±¡æœ«å°¾æ—¶ï¼Œéƒ½ä¼šæŠ¥é”™ã€‚</p>

<p>â€œæŒ‡é’ˆâ€çš„å­˜åœ¨è¯´æ˜ File object æ˜¯å¯¹è‡ªå·±å†…éƒ¨æŒ‡å‘çš„ä½ç½®æœ‰è®°å½•è¿½è¸ªçš„ã€‚</p>

<p>â€”-</p>

<p><strong>Seeking and querying file position</strong></p>

<p>â€”-</p>

<p>The File object has a sense of where in the file it has left off reading. You can both read and change this internal pointer explicitly, using the File objectâ€™s pos (position) attribute and/or the seek method.</p>

<p>File å¯¹è±¡æœ‰ä¸€ä¸ª pos (position) å±æ€§ï¼Œä»¥åŠ seek æ–¹æ³•æ¥å¤„ç†å†…éƒ¨æŒ‡é’ˆä½ç½®</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">035</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">rewind</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">036</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">pos</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">037</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">gets</span>
 <span class="o">=&gt;</span> <span class="s2">"class Ticket</span><span class="se">\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">03</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">pos</span>
 <span class="o">=&gt;</span> <span class="mi">13</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">03</span><span class="mi">9</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>ä½¿ç”¨gets è¯»å–ä¸€è¡Œä¹‹å æŒ‡é’ˆä½ç½®ä»èµ·å§‹ä½ç½®0 å˜ä¸ºäº†13</p>

<p>0 åˆ° 13 è¿™ä¸ªé•¿åº¦æ˜¯ä»¥ byte å­—èŠ‚ä¸ºå•ä½çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šä½ç½®</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">03</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">pos</span> <span class="o">=</span> <span class="mi">7</span>
 <span class="o">=&gt;</span> <span class="mi">7</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">040</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">readline</span>
 <span class="o">=&gt;</span> <span class="s2">"icket</span><span class="se">\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">041</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>ç›´æ¥ä½¿ç”¨ pos =  èµ‹å€¼æ“ä½œ</p>

<p>seek æ–¹æ³•é…åˆ å‡ ä¸ª(ä½ç½®)å¸¸é‡å¯ä»¥è¿›è¡Œä¸‰ç§æ“ä½œ</p>

<p>1 æŒ‡å®šç›¸å¯¹äºå¼€å¤´çš„ä½ç½®ï¼Œf.seek(20, IO::SEEK_SET) ã€‚ä¹Ÿå¯ä»¥ç›´æ¥ f.seek(20) æˆ–ä½¿ç”¨ pos=</p>

<p>2 æŒ‡å®šç›¸å¯¹äºå½“å‰ä½ç½®çš„ä½ç½®ï¼Œ f.seek(5, IO::SEEK_CUR)</p>

<p>3 æŒ‡å®šç›¸å¯¹äºæœ«å°¾çš„ä½ç½®ï¼Œ f.seek(-10, IO::SEEK_END)</p>

<p>æ³¨æ„æœ€åä¸€è¡Œ ä½¿ç”¨çš„æ•°å­—æ˜¯ è´Ÿå€¼</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">041</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">rewind</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">042</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">seek</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">043</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">pos</span>
 <span class="o">=&gt;</span> <span class="mi">20</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">044</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">seek</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="no">IO</span><span class="o">::</span><span class="no">SEEK_CUR</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">045</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">pos</span>
 <span class="o">=&gt;</span> <span class="mi">25</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">046</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="no">IO</span><span class="o">::</span><span class="no">SEEK_END</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">047</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">pos</span>
 <span class="o">=&gt;</span> <span class="mi">213</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">04</span><span class="mi">8</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>â€”-</p>

<p>ä¹‹å‰çš„å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯ IO è¿™ä¸ª class ä¸­çš„ï¼Œ å®é™…ä¸Š File è¿™ä¸ª class æœ¬èº«ä¹Ÿæœ‰é’ˆå¯¹å…¶å®ä¾‹çš„è¯»å–æ–¹æ³•</p>

<p><strong>Reading files with File class methods</strong></p>

<p>A little later, youâ€™ll see more of the facilities available as class methods of File. For now, weâ€™ll look at two methods that handle file reading at the class level: File.read and File.readlines.</p>

<p>å…ˆçœ‹ä¸¤ä¸ª  class å±‚çº§çš„ methods</p>

<p>File.read å’Œ File.readlines</p>

<p>In the first case, you get a string containing the entire contents of the file. In the second case, you get an array of lines.
These two class methods exist purely for convenience. They take care of opening and closing the file handle for you; you donâ€™t have to do any system-level housekeeping. Most of the time, youâ€™ll want to do something more complex and/or more efficient than reading the entire contents of a file into a string or an array at one time. Given that even the read and readlines instance methods are relatively coarse-grained tools, if you decide to read a file in all at once, you may as well go all the way and use the class-method versions.</p>

<p>è¿™ä¸ªä¸¤ä¸ªæ–¹æ³•å’Œä¹‹å‰æåˆ°çš„ read, readlinesæ–¹æ³•çš„åŠŸèƒ½ç›¸åŒï¼Œä»–ä»¬çš„å­˜åœ¨åªæ˜¯ä¸ºäº†ç®€åŒ–æ“ä½œã€‚ä½¿ç”¨è¿™ä¸ªä¸¤ä¸ª class å±‚çº§çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨å…ˆä½¿ç”¨ File.new å®ä¾‹åŒ–ä¸€ä¸ª File å¯¹è±¡ï¼Œåœ¨å¯¹å…¶è¿›è¡Œè¯»å–æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ª class methods è¿›è¡Œè¯»å–</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/ticket2.rb"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="s2">"class Ticket</span><span class="se">\n</span><span class="s2">  def initialize(venue, date)</span><span class="se">\n</span><span class="s2">    @venue = venue</span><span class="se">\n</span><span class="s2">    @date = date</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def price=(price)</span><span class="se">\n</span><span class="s2">    @price = price</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def venue</span><span class="se">\n</span><span class="s2">    @venue</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def date</span><span class="se">\n</span><span class="s2">    @date</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n\n</span><span class="s2">  def price</span><span class="se">\n</span><span class="s2">    @price</span><span class="se">\n</span><span class="s2">  end</span><span class="se">\n</span><span class="s2">end</span><span class="se">\n</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">class</span>
 <span class="o">=&gt;</span> <span class="no">String</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="n">ff</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">readlines</span><span class="p">(</span><span class="s2">"/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/ticket2.rb"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"class Ticket</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  def initialize(venue, date)</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"    @venue = venue</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"    @date = date</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  end</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  def price=(price)</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"    @price = price</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  end</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  def venue</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"    @venue</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  end</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  def date</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"    @date</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  end</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  def price</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"    @price</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"  end</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"end</span><span class="se">\n</span><span class="s2">"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="n">ff</span><span class="p">.</span><span class="nf">class</span>
 <span class="o">=&gt;</span> <span class="no">Array</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>â€”</p>

<p><strong>Low level I / O methods</strong></p>

<p>åº•å±‚çš„ I/O æ–¹æ³•</p>

<p>â€”</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sysseek
sysread
syswrite
</code></pre></div></div>

<p>è¿™ä¸‰ä¸ª method æ˜¯ç³»ç»Ÿå±‚çº§çš„æ–¹æ³•ï¼Œsys- ç±»æ–¹æ³•æ‰§è¡Œçš„æ˜¯åŸç”Ÿçš„ï¼Œæœªç¼“å­˜çš„æ•°æ®ï¼Œä¸è¦å°†ä»–ä»¬ä¸é«˜å±‚çº§çš„æ–¹æ³•æ··èµ·æ¥ä½¿ç”¨ã€‚</p>

<p>æ¯”å¦‚ print ç­‰</p>

<p>â€”-</p>

<p>Writing to files</p>

<p>â€”-</p>

<p>Writing to a file involves using puts, print, or write on a File object thatâ€™s opened in write or append mode. Write mode is indicated by w as the second argument to new. In this mode, the file is created (assuming you have permission to create it); if it existed already, the old version is overwritten. In append mode (indicated by a), whatever you write to the file is appended to whatâ€™s already there. If the file doesnâ€™t exist yet, opening it in append mode creates it.</p>

<p>å†™å…¥ä¿¡æ¯åˆ°ä¸€ä¸ªæ–‡ä»¶ä¼š å¯¹ä¸€ä¸ª ä»¥ write æˆ– append æ¨¡å¼æ‰“å¼€çš„æ–‡ä»¶å¯¹è±¡ ä½¿ç”¨ puts print write æ–¹æ³•ã€‚</p>

<p>w  ä»£è¡¨ write only æ¨¡å¼, ä½œä¸º File.new çš„ç¬¬äºŒä¸ªå‚æ•°</p>

<p>åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨ï¼Œé‚£ä¹ˆæ—§æ–‡ä»¶ä¸­çš„å†…å®¹ä¼šè¢«å†™å…¥çš„æ–°å†…å®¹ç›´æ¥è¦†ç›–æ‰ã€‚</p>

<p>åœ¨ a (append) æ¨¡å¼ä¸‹ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¹Ÿä¼šåˆ›å»ºæ–°æ–‡ä»¶ï¼Œå¦‚æœå·²ç»æœ‰åŒåæ–‡ä»¶ï¼Œé‚£ä¹ˆå†™å…¥çš„å†…å®¹å°†ä¼š é™„åŠ åœ¨å·²æœ‰å†…å®¹ä¹‹åã€‚</p>

<p>æ³¨æ„åœ¨ä¸ç»™å‡ºç¬¬äºŒä¸ªå‚æ•°(mode)æ—¶ï¼Œä½¿ç”¨ä¸å­˜åœ¨çš„æ–‡ä»¶åå°†ä¼šæŠ¥é”™</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"data.out"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;File:data.out&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">006</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"David A. Black, Rubyist"</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">close</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"data.out"</span><span class="p">)</span>
<span class="no">David</span> <span class="no">A</span><span class="o">.</span> <span class="no">Black</span><span class="p">,</span> <span class="no">Rubyist</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"data.out"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;File:data.out&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">010</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"This time open f with 'a' mode."</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">011</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">close</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">012</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"data.out"</span><span class="p">)</span>
<span class="no">David</span> <span class="no">A</span><span class="o">.</span> <span class="no">Black</span><span class="p">,</span> <span class="no">Rubyist</span>
<span class="no">This</span> <span class="n">time</span> <span class="nb">open</span> <span class="n">f</span> <span class="n">with</span> <span class="s1">'a'</span> <span class="n">mode</span><span class="p">.</span>
 <span class="nf">=</span><span class="o">&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">013</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>Ruby lets you economize on explicit closing of File objectsâ€”and enables you to keep your code nicely encapsulatedâ€”by providing a way to perform file operations inside a code block. Weâ€™ll look at this elegant and common technique next.</p>

<p>Ruby è®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨block æ¥ç®€åŒ– å…³é—­æ–‡ä»¶çš„æ“ä½œ</p>

<p>â€”-</p>

<p><strong>Using blocks to scope file operations</strong></p>

<p>â€”-</p>

<p>ä½¿ç”¨ File.new æ¥åˆ›å»º file object æœ‰ä¸€ä¸ªç¼ºç‚¹æ˜¯æ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨å…³é—­æ–‡ä»¶ã€‚ruby ä¸ºæ­¤æä¾›çš„æ–¹æ¡ˆæ˜¯ ä½¿ç”¨ File.open åŠ  block çš„ç»„åˆï¼Œblock æ‰§è¡Œå®Œæ¯•åä¼šè‡ªåŠ¨å…³é—­æ–‡ä»¶ã€‚</p>

<p>ç°åœ¨æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ records.txt</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Pablo</span> <span class="no">Casals</span><span class="o">|</span><span class="no">Catalan</span><span class="o">|</span><span class="n">cello</span><span class="o">|</span><span class="mi">1876</span><span class="o">-</span><span class="mi">1973</span>
<span class="no">Jascha</span> <span class="no">Heifetz</span><span class="o">|</span><span class="no">Russian</span><span class="o">-</span><span class="no">American</span><span class="o">|</span><span class="n">violin</span><span class="o">|</span><span class="mi">1901</span><span class="o">-</span><span class="mi">1988</span>
<span class="no">Emanuel</span> <span class="no">Feuermann</span><span class="o">|</span><span class="no">Austrian</span><span class="o">-</span><span class="no">American</span><span class="o">|</span><span class="n">cello</span><span class="o">|</span><span class="mi">1902</span><span class="o">-</span><span class="mi">1942</span>
</code></pre></div></div>

<p>è¿›è¡Œå¦‚ä¸‹æ“ä½œ</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"records.txt"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>  <span class="c1"># records.txt is being in current directory</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span>     <span class="k">while</span> <span class="n">record</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">gets</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span><span class="p">?</span><span class="o">&gt;</span>     <span class="nb">name</span><span class="p">,</span> <span class="n">nationality</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="n">dates</span> <span class="o">=</span> <span class="n">record</span><span class="p">.</span><span class="nf">chomp</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'|'</span><span class="p">)</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span><span class="p">?</span><span class="o">&gt;</span>     <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="n">dates</span><span class="si">}</span><span class="s2">), who was </span><span class="si">#{</span><span class="n">nationality</span><span class="si">}</span><span class="s2">, played </span><span class="si">#{</span><span class="n">instrument</span><span class="si">}</span><span class="s2">."</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span><span class="p">?</span><span class="o">&gt;</span>     <span class="k">end</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">006</span><span class="p">?</span><span class="o">&gt;</span>   <span class="k">end</span>
<span class="no">Pablo</span> <span class="no">Casals</span> <span class="p">(</span><span class="mi">1876</span><span class="o">-</span><span class="mi">1973</span><span class="p">),</span> <span class="n">who</span> <span class="n">was</span> <span class="no">Catalan</span><span class="p">,</span> <span class="n">played</span> <span class="n">cello</span><span class="o">.</span>
<span class="no">Jascha</span> <span class="no">Heifetz</span> <span class="p">(</span><span class="mi">1901</span><span class="o">-</span><span class="mi">1988</span><span class="p">),</span> <span class="n">who</span> <span class="n">was</span> <span class="no">Russian</span><span class="o">-</span><span class="no">American</span><span class="p">,</span> <span class="n">played</span> <span class="n">violin</span><span class="o">.</span>
<span class="no">Emanuel</span> <span class="no">Feuermann</span> <span class="p">(</span><span class="mi">1902</span><span class="o">-</span><span class="mi">1942</span><span class="p">),</span> <span class="n">who</span> <span class="n">was</span> <span class="no">Austrian</span><span class="o">-</span><span class="no">American</span><span class="p">,</span> <span class="n">played</span> <span class="n">cello</span><span class="p">.</span>
 <span class="nf">=</span><span class="o">&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>The program consists entirely of a call to File.open along with its code block. (If you call File.open without a block, it acts like File.new.) The block parameter, f, receives the File object. Inside the block, the file is read one line at a time using f. The while test succeeds as long as lines are coming in from the file. When the program hits the end of the input file, gets returns nil, and the while condition fails.
Inside the while loop, the current line is chomped so as to remove the final newline character, if any, and split on the pipe character. The resulting values are stored in the four local variables on the left, and those variables are then interpolated into a pretty-looking report for output:</p>

<table>
  <tbody>
    <tr>
      <td>æ•´ä¸ªç¨‹å¼åœ¨  File.open èµ·å¤´çš„block å®Œæˆã€‚ Block parameter</td>
      <td>f</td>
      <td>ä»£è¡¨äº†è¿™ä¸ª file object.</td>
    </tr>
  </tbody>
</table>

<p>While â€¦ end æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œ record = f.gets ä¼šä¸€æ¬¡ä¼šæ‹¿æ–‡ä»¶ä¸­çš„ä¸€è¡Œå†…å®¹ã€‚å½“å¾ªç¯åˆ°æœ€åä¸€è¡Œä¹‹å f.gets ä¼šè¿”å› nil ï¼Œ è¿™æ—¶ while loop ç»“æŸ</p>

<table>
  <tbody>
    <tr>
      <td>æ‹¿åˆ°æ¯è¡Œå†…å®¹åï¼Œä»¥</td>
      <td>ä¸ºåˆ†éš”ç¬¦å· split å†…å®¹ï¼Œåˆ†åˆ«èµ‹å€¼ç»™ name , nationality, instrument, dates</td>
    </tr>
  </tbody>
</table>

<p>record.chomp ä¼šåƒæ‰ä¸€è¡Œæœ«å°¾çš„æ¢è¡Œç¬¦å·</p>

<p>â€”-</p>

<p><strong>File enumerability</strong></p>

<p>â€”-</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">ancestors</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="no">File</span><span class="p">,</span> <span class="no">IO</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">Constants</span><span class="p">,</span> <span class="no">Enumerable</span><span class="p">,</span> <span class="no">Object</span><span class="p">,</span> <span class="no">Kernel</span><span class="p">,</span> <span class="no">BasicObject</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">ancestors</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
 <span class="o">=&gt;</span> <span class="no">Enumerable</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">010</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>Enumerable æ˜¯ File çˆ¶å…ƒç´ é“¾ä¸­çš„ä¸€ç¯ï¼ŒFileå¯¹è±¡å…·æœ‰å¯æšä¸¾æ€§ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½åœ¨ä¸Šä¸€ä¸ªä¾‹å­ä¸­ä½¿ç”¨ loop å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ“ä½œã€‚</p>

<p>Ruby gracefully stops iterating when it hits the end of the file.
As enumerables, File objects can perform many of the same functions that arrays, hashes, and other collections do. Understanding how file enumeration works requires a slightly different mental model: whereas an array exists already and walks through its elements in the course of iteration, File objects have to manage line-by-line reading behind the scenes when you iterate through them. But the similarity of the idiomsâ€”the common use of the methods from Enumerableâ€”means you donâ€™t have to think in much detail about the file-reading process when you iterate through a file.</p>

<p>Most important, donâ€™t forget that you can iterate through files and address them as enumerables. Itâ€™s tempting to read a whole file into an array and then process the array. But why not just iterate on the file and avoid wasting the space required to hold the fileâ€™s contents in memory?</p>

<p>Rubyä¼šåœ¨åˆ°è¾¾æ–‡ä»¶æœ«å°¾ä½ç½®æ—¶è‡ªåŠ¨åœæ­¢è¿­ä»£æ“ä½œã€‚</p>

<p>ä½œä¸ºå¯æšä¸¾çš„ç‰©ä»¶ï¼Œ file å¯¹è±¡ å¯ä»¥è¿›è¡Œå¾ˆå¤šåƒ array å’Œ hash èƒ½è¿›è¡Œçš„è¿­ä»£æ“ä½œï¼Œä¸€ä¸ªåŒºåˆ«æ˜¯ file object çš„è¿­ä»£æ˜¯ä»¥ è¡Œ ä¸ºå•ä½è¿›è¡Œçš„ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥å…ˆå°†ä¸€ä¸ªfile object ä¸­çš„ content å…¨éƒ¨è¯»å‡ºæ¥æ”¾åˆ°ä¸€ä¸ª array ä¸­ï¼Œç„¶åå†è¿›è¡Œå…¶ä»–æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å¿…è¦è¿™æ ·æµªè´¹å†…å­˜ã€‚</p>

<p>ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ members.txt</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">David</span> <span class="no">Black</span> <span class="n">male</span> <span class="mi">55</span>
<span class="no">Caven</span> <span class="no">Xu</span> <span class="n">male</span> <span class="mi">18</span>
<span class="no">Lee</span> <span class="no">Hans</span> <span class="n">female</span> <span class="mi">23</span>
</code></pre></div></div>

<p>å¦‚æœæˆ‘ä»¬æƒ³è¦æŠŠæ–‡ä»¶ä¸­çš„æ‰€æœ‰äººçš„ å¹´é¾„ä¿¡æ¯åŠ æ€»èµ·æ¥</p>

<p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¹‹å‰æåˆ°çš„å…ˆå°†ä¿¡æ¯æå–åˆ°å¤–éƒ¨ array ä¸­ç„¶åè¿›è¡Œæ“ä½œ</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># File.readlines('members.txt') actually is an array</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">01</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">total_age</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">readlines</span><span class="p">(</span><span class="s1">'members.txt'</span><span class="p">).</span><span class="nf">inject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">total</span><span class="p">,</span> <span class="n">line</span><span class="o">|</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">01</span><span class="mi">9</span> <span class="o">&gt;</span>     <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">020</span><span class="p">?</span><span class="o">&gt;</span>     <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">021</span><span class="p">?</span><span class="o">&gt;</span>     <span class="n">age</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nf">to_i</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">022</span><span class="p">?</span><span class="o">&gt;</span>     <span class="n">total</span> <span class="o">+</span> <span class="n">age</span> <span class="c1"># return value will be the next acc's value</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">023</span><span class="p">?</span><span class="o">&gt;</span>   <span class="k">end</span>
<span class="o">=&gt;</span> <span class="mi">96</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">024</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="s2">"Average age is: </span><span class="si">#{</span><span class="n">total_age</span><span class="o">/</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span>
<span class="no">Average</span> <span class="n">age</span> <span class="ss">is: </span><span class="mi">32</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">025</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åªä½¿ç”¨ File å¯¹è±¡çš„æšä¸¾æ“ä½œåœ¨æ–‡ä»¶æœ¬èº«å®Œæˆä¸Šé¢çš„ä»»åŠ¡</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">02</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">02</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">total_ages</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"members.txt"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">030</span> <span class="o">&gt;</span>     <span class="n">f</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">total</span><span class="p">,</span> <span class="n">line</span><span class="o">|</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">031</span> <span class="o">&gt;</span>       <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">032</span><span class="p">?</span><span class="o">&gt;</span>       <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">033</span><span class="p">?</span><span class="o">&gt;</span>       <span class="n">age</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nf">to_i</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">034</span><span class="p">?</span><span class="o">&gt;</span>       <span class="n">total</span> <span class="o">+</span> <span class="n">age</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">035</span><span class="p">?</span><span class="o">&gt;</span>     <span class="k">end</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">036</span><span class="p">?</span><span class="o">&gt;</span>   <span class="k">end</span>
 <span class="o">=&gt;</span> <span class="mi">96</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">037</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>â€”</p>

<p><strong>File I / O exceptions and errors</strong></p>

<p>â€”</p>

<p>When something goes wrong with file operations, Ruby raises an exception. Most of the errors youâ€™ll get in the course of working with files can be found in the Errno namespace: Errno::EACCES (permission denied), Errno::ENOENT (no such entityâ€”a file or directory), Errno:EISDIR (is a directoryâ€”an error you get when â€œyou try to open a directory as if it were a file), and others. Youâ€™ll always get a message along with the exception:</p>

<p>å¸¸è§é”™è¯¯éƒ½æ˜¯ä»¥ Errno ä½œä¸ºå¼€å¤´çš„ namespace</p>

<ul>
  <li>
    <p>Errno::EACCES æƒé™ä¸å¤Ÿ</p>
  </li>
  <li>
    <p>Errno::ENOENT æ²¡æœ‰æŒ‡å®šçš„å¯¹è±¡</p>
  </li>
  <li>
    <p>Errno::EISDIR â€”is a directory</p>
  </li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">037</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"unknown"</span><span class="p">)</span>
<span class="no">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
        <span class="mi">4</span><span class="p">:</span> <span class="n">from</span> <span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="p">.</span><span class="nf">rvm</span><span class="o">/</span><span class="n">rubies</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">irb</span><span class="p">:</span><span class="mi">11</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;'
        3: from (irb):37
        2: from (irb):37:in `</span><span class="nb">open</span><span class="s1">'
        1: from (irb):37:in `initialize'</span>
<span class="no">Errno</span><span class="o">::</span><span class="no">ENOENT</span> <span class="p">(</span><span class="no">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span> <span class="err">@</span> <span class="n">rb_sysopen</span> <span class="o">-</span> <span class="n">unknown</span><span class="p">)</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">03</span><span class="mi">8</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>Errno ç³»åˆ—é”™è¯¯ä¸ä»…åŒ…å«ä¸æ–‡ä»¶ç›¸å…³çš„é”™è¯¯ï¼Œä¹ŸåŒ…å«ç³»ç»Ÿå±‚çº§çš„é”™è¯¯ï¼Œè¿™äº›é”™è¯¯å¯èƒ½ä¼šä½¿ç”¨æ•°å­—æ¥ä»£è¡¨</p>

<p>Each Errno exception class contains knowledge of the integer to which its corresponding system error maps. You can get these numbers via the Errno constant of each Errno classâ€”and if that sounds obscure, an example will make it clearer:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">040</span> <span class="o">&gt;</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ENOTDIR</span><span class="o">::</span><span class="no">Errno</span>
 <span class="o">=&gt;</span> <span class="mi">20</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">041</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>Youâ€™ll rarely, if ever, have to concern yourself with the mapping of Rubyâ€™s Errno exception classes to the integers to which your operating system maps errors. But you should be aware that any Errno exception is basically a system error percolating up through Ruby. These arenâ€™t Ruby-specific errors, like syntax errors or missing method errors; they involve things going wrong at the system level. In these situations, Ruby is just the messenger.</p>

<p>é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬å¾ˆå°‘å»å…³æ³¨è¿™äº›ç³»ç»Ÿé”™è¯¯çš„ç¼–å·ã€‚ä½†æœ‰ä¸€ç‚¹è¦æ˜ç¡®çš„æ˜¯ä»»ä½• Errno é”™è¯¯åŸºæœ¬éƒ½æ˜¯ä»ç³»ç»Ÿå±‚é¢ æ¸—é€ åˆ°rubyè¿™é‡Œçš„ï¼Œsyntax errors, missing method errors, è¿™äº›éƒ½ä¸æ˜¯ ruby ç‰¹æœ‰çš„ï¼Œéƒ½åŒ…å«ç³»ç»Ÿå±‚çº§çš„é”™è¯¯ï¼Œåœ¨è¿™äº›æƒ…å¢ƒä¸­ï¼Œruby åªæ˜¯ä¸€ä¸ªä¿¡ä½¿ã€‚</p>

<p>â€”-</p>

<p><strong>Querying IO and File objects</strong></p>

<p>â€”-</p>

<p>IO å’Œ File è¿™ä¸¤ä¸ª class ä¸­éƒ½æœ‰querying ç›¸å…³çš„methods. åè€…ä¸­åŒ…å«çš„æ›´å¤š</p>

<p>The File class also has some query methods. In some cases, you can get the same information about a file several ways:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="s1">'/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/ticket2.rb'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="mi">223</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="no">FileTest</span><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="s1">'/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/ticket2.rb'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="mi">223</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span> <span class="no">File</span><span class="o">::</span><span class="no">Stat</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/ticket2.rb'</span><span class="p">).</span><span class="nf">size</span>
 <span class="o">=&gt;</span> <span class="mi">223</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">006</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>â€”-</p>

<p>Getting information form the File class and the FileTest module</p>

<p>â€”-</p>

<p>File and FileTest offer numerous query methods that can give you lots of information about a file. These are the main categories of query: What is it? What can it do? How big is it?â€</p>

<p>å¯¹æ–‡ä»¶çš„ query ä¸»è¦ä¸‰ä¸ªæ–¹é¢ï¼Œæ˜¯ä»€ä¹ˆï¼Ÿ èƒ½åšä»€ä¹ˆï¼Ÿ æœ‰å¤šå¤§ï¼Ÿ</p>

<p>The methods available as class methods of File and FileTest are almost identical; theyâ€™re mostly aliases of each other. The examples will only use FileTest, but you can use File too.</p>

<p>File å’Œ FileTest ä¸­å…³äº querying çš„æ–¹æ³•åç§°å‡ ä¹éƒ½æ˜¯ä¸€æ ·çš„</p>

<p>Here are some questions you might want to ask about a given file, along with the techniques for asking them. All of these methods return either true or false except size, which returns an integer. Keep in mind that these file-testing methods are happy to take directories, links, sockets, and other filelike entities as their arguments. Theyâ€™re not restricted to regular files:</p>

<p>å¤šæ•°è¿™ç±» methods éƒ½è¿”å› boolean å€¼ï¼Œ é™¤äº† size , è€Œä¸”è¿™äº›æ–¹æ³•èƒ½å¤„ç†å¾ˆå¤šç±»å‹çš„ ç±»æ–‡ä»¶ å¯¹è±¡ï¼Œ å¹¶ä¸ä¸€å®šä¸¥æ ¼é™åˆ¶äºæ™®é€šçš„æ–‡ä»¶ç±»å‹ã€‚</p>

<p><code class="highlighter-rouge">FileTest.directory?()</code>  åˆ¤æ–­ç»™å‡ºå¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªè·¯å¾„</p>

<p><code class="highlighter-rouge">FileTest.file?()</code>  åˆ¤æ–­ç»™å‡ºå¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªæ–‡ä»¶</p>

<p><code class="highlighter-rouge">FileTest.symlink?()</code>  åˆ¤æ–­ç»™å‡ºå¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ª symbolic link (Returns true if the named file is a symbolic link.)</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span> <span class="no">FileTest</span><span class="p">.</span><span class="nf">directory?</span><span class="p">(</span><span class="s1">'/users/caven/'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="no">FileTest</span><span class="p">.</span><span class="nf">file?</span><span class="p">(</span><span class="s1">'/users/caven/'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">false</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="no">FileTest</span><span class="p">.</span><span class="nf">symlink?</span><span class="p">(</span><span class="s1">'/users/caven/'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">false</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">010</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>ä¹Ÿå¯ä»¥æµ‹è¯•ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦ å¯è¯»ï¼Œ å¯å†™ï¼Œ æˆ– å¯æ‰§è¡Œ</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">011</span> <span class="o">&gt;</span> <span class="no">FileTest</span><span class="p">.</span><span class="nf">readable?</span><span class="p">(</span><span class="s1">'/users/caven/'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">012</span> <span class="o">&gt;</span> <span class="no">FileTest</span><span class="p">.</span><span class="nf">writable?</span><span class="p">(</span><span class="s1">'/users/caven/'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">013</span> <span class="o">&gt;</span> <span class="no">FileTest</span><span class="p">.</span><span class="nf">executable?</span><span class="p">(</span><span class="s1">'/users/caven/'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">014</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>This family of query methods includes world_readable? and world_writable?, which test for more permissive permissions. It also includes variants of the basic three methods with <code class="highlighter-rouge">_real</code> appended. These test the permissions of the scriptâ€™s actual runtime ID as opposed to its effective user ID.</p>

<p>è¿™ç±»æ–¹æ³•è¿˜æœ‰ç±»ä¼¼çš„ world_readable? , world_writable? ç­‰ï¼Œç”¨äºåœ¨æƒé™é™åˆ¶æ›´ä¸¥æ ¼çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p>

<p><code class="highlighter-rouge">FileTest.size(â€œ/home/users/dblack/setup")</code> æµ‹è¯•æ–‡ä»¶å¤§å°</p>

<p><code class="highlighter-rouge">FileTest.zero?(â€œ/tmp/tempfileâ€)</code>  æµ‹è¯•æ–‡ä»¶æ˜¯å¦ä¸ºç©º</p>

<p>â€”-</p>

<p>Getting file information with Kernel#test</p>

<p>â€”-</p>

<p>Among the top-level methods at your disposal (that is, private methods of the Kernel module, which you can call anywhere without a receiver, like puts) is a method called test. You use test by passing it two arguments: the first represents the test, and the second is a file or directory. The choice of test is indicated by a character. You can represent the value using the ?c notation, where c is the character, or as a one-character string.</p>

<p>å…³äºæŸ¥è¯¢æ–‡ä»¶ä¿¡æ¯çš„é«˜ç­‰çº§ï¼ˆé‚£äº›é è¿‘é¡¶éƒ¨çš„moduleä¸­çš„æ–¹æ³•ï¼‰çš„methods å½“ä¸­ï¼Œæœ‰ä¸€ä¸ªå« testã€‚</p>

<p>test  æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•° ä»£è¡¨æµ‹è¯•çš„å†…å®¹ï¼Œç¬¬äºŒä¸ªæ˜¯è¦æµ‹çš„å¯¹è±¡</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">014</span> <span class="o">&gt;</span> <span class="nb">test</span><span class="p">(</span><span class="sc">?e</span><span class="p">,</span> <span class="s1">'/users/caven/'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">015</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">?e</code> è¯­ä¹‰ä¸Šç›¸å½“äº  existï¼Ÿ</p>

<p>ç±»ä¼¼çš„è¿˜æœ‰</p>

<p><code class="highlighter-rouge">?d</code> å¯¹åº” directory?
<code class="highlighter-rouge">?f</code> æµ‹è¯•å¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ª regular file
<code class="highlighter-rouge">?z</code> æµ‹è¯•å¤§å°æ˜¯å¦ä¸º 0</p>

<p>For every test available through Kernel#test, thereâ€™s usually a way to get the result by calling a method of one of the classes discussed in this section. But the Kernel#test notation is shorter and can be handy for that reason.</p>

<p>è¿™äº›çŸ­å°çš„ ä»£è¡¨ç¬¦å· åœ¨ä¹‹å‰æåˆ°çš„ class ä¸­å‡ ä¹éƒ½å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ï¼Œä½†æ˜¯  Kernel#test åŠ  æ ‡è®°çš„ç”¨æ³•æ›´åŠ çŸ­å°æ–¹ä¾¿</p>

<p>â€”</p>

<p>é™¤äº† FileTest å’Œ File ä¸­æœ‰æŸ¥è¯¢æ–‡ä»¶ä¿¡æ¯çš„æ–¹æ³•ï¼Œå¦ä¸€ä¸ª class File::Stat ä¸­ä¹Ÿæœ‰ ï¼ˆstatisticalï¼‰</p>

<p>ä¸¤ç§æ–¹æ³•æ–°å»º File::Stat å¯¹è±¡</p>

<p>1 ä½¿ç”¨ File::Stat.new(#file/dir)</p>

<table>
  <tbody>
    <tr>
      <td>2 ä½¿ç”¨ File.open(#file/dir) {</td>
      <td>f</td>
      <td>f.stat }</td>
    </tr>
  </tbody>
</table>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">01</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="no">File</span><span class="o">::</span><span class="no">Stat</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'/users/caven/'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;File::Stat dev=0x1000004, ino=733544, mode=040755, nlink=73, uid=503, gid=20, rdev=0x0, size=2336, blksize=4194304, blocks=0, atime=2018-02-11 14:04:04 +0800, mtime=2018-02-11 14:04:04 +0800, ctime=2018-02-11 14:04:04 +0800, birthtime=2016-12-11 13:17:41 +0800&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">01</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'/users/caven/'</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span> <span class="n">d</span><span class="p">.</span><span class="nf">stat</span> <span class="p">}</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;File::Stat dev=0x1000004, ino=733544, mode=040755, nlink=73, uid=503, gid=20, rdev=0x0, size=2336, blksize=4194304, blocks=0, atime=2018-02-11 14:04:04 +0800, mtime=2018-02-11 14:04:04 +0800, ctime=2018-02-11 14:04:04 +0800, birthtime=2016-12-11 13:17:41 +0800&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">020</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>The screen output from the File::Stat.new method shows you the attributes of the object, including its times of creation (ctime), last modification (mtime), and last access (atime).</p>

<p>è¿™ä¸ªæ–¹æ³•ä¼šæ˜¾ç¤ºå…³äºæ­¤å¯¹è±¡çš„å¾ˆå¤šç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å»ºç«‹æ—¶é—´ï¼Œä¿®æ”¹æ—¶é—´ï¼Œæœ€åä¸€æ¬¡æ–¹æ³•æ—¶é—´ç­‰</p>

<table>
  <tbody>
    <tr>
      <td>The code block given to File.open in this example, {</td>
      <td>f</td>
      <td>f.stat }, evaluates to the last expression inside it. Because the last (indeed, only) expression is f.stat, the value of the block is a File::Stat object. In general, when you use File.open with a code block, the call to File.open returns the last value from the block. Called without a block, File.open (like File.new) returns the newly created File object.</td>
    </tr>
  </tbody>
</table>

<p>æ³¨æ„ç¬¬äºŒç§ä½¿ç”¨ block çš„æ–¹æ³•ï¼Œè¿™è¡Œä»£ç æœ€åè¿”å›çš„å€¼ä¼šæ˜¯ æ‰§è¡Œå®Œ block ä¸­çš„ä»£ç çš„å€¼
Block ä¸­çš„ f æŒ‡ä»£çš„æ˜¯ä¸€ä¸ª file object ,å¯¹ä»–ä½¿ç”¨äº† .stat æ–¹æ³•
è¿™å’Œå…ˆå•ç‹¬èµ‹å€¼ï¼Œå†ä½¿ç”¨æ•ˆæœç›¸ç­‰</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">020</span> <span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'/users/caven/'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;File:/users/caven/&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">021</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">stat</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;File::Stat dev=0x1000004, ino=733544, mode=040755, nlink=73, uid=503, gid=20, rdev=0x0, size=2336, blksize=4194304, blocks=0, atime=2018-02-11 14:04:04 +0800, mtime=2018-02-11 14:04:04 +0800, ctime=2018-02-11 14:04:04 +0800, birthtime=2016-12-11 13:17:41 +0800&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">022</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>Much of the information available from File::Stat is built off of UNIX-like metrics, such as inode number, access mode (permissions), and user and group ID. The relevance of this information depends on your operating system. We wonâ€™t go into the details here because itâ€™s not cross-platform; but whatever information your system maintains about files is available if you need it.â€</p>

<p>File::Stat æ–¹æ³•è¿”å›çš„ä¿¡æ¯ä¸­å¾ˆå¤šæ˜¯åŸºäº UNIX-like æ ‡å‡†çš„ï¼Œåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­å¯èƒ½ä¼šæœ‰ä¸åŒã€‚</p>

<p>â€”-</p>

<p>Directory manipulation with the Dir class</p>

<p>class Dir å¯¹æ–‡ä»¶è·¯å¾„è¿›è¡Œæ“ä½œ</p>

<p>â€”-</p>

<p>ä½¿ç”¨ .new  æ–°å»ºä¸€ä¸ª Dir instance</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">02</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'/users/caven/rubyist/'</span><span class="p">)</span>
<span class="no">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
        <span class="mi">4</span><span class="p">:</span> <span class="n">from</span> <span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="p">.</span><span class="nf">rvm</span><span class="o">/</span><span class="n">rubies</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">irb</span><span class="p">:</span><span class="mi">11</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;'
        3: from (irb):28
        2: from (irb):28:in `</span><span class="n">new</span><span class="s1">'
        1: from (irb):28:in `initialize'</span>
<span class="no">Errno</span><span class="o">::</span><span class="no">ENOENT</span> <span class="p">(</span><span class="no">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span> <span class="err">@</span> <span class="n">dir_initialize</span> <span class="o">-</span> <span class="sr">/users/</span><span class="n">caven</span><span class="o">/</span><span class="n">rubyist</span><span class="o">/</span><span class="p">)</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">02</span><span class="mi">9</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>æ³¨æ„è¿™é‡Œçš„ new ä¸æ˜¯ æ–°å»ºè·¯å¾„ çš„æ„æ€ï¼Œè€Œæ˜¯æ ¹æ®å·²æœ‰è·¯å¾„å»ºç«‹ä¸€ä¸ª Dir instance
å¦‚æœè¾“å…¥çš„è·¯å¾„æ˜¯ä¸å­˜åœ¨çš„ä¼šæŠ¥é”™</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">caven</span><span class="vi">@caven</span> <span class="err">â®€</span> <span class="o">~</span> <span class="err">â®€</span> <span class="n">pwd</span>
<span class="sr">/Users/</span><span class="n">caven</span>
<span class="n">caven</span><span class="vi">@caven</span> <span class="err">â®€</span> <span class="o">~</span> <span class="err">â®€</span> <span class="n">mkdir</span> <span class="n">rubyist</span>
<span class="n">caven</span><span class="vi">@caven</span> <span class="err">â®€</span> <span class="o">~</span> <span class="err">â®€</span> <span class="n">irb</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'/users/caven/rubyist/'</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Dir:/users/caven/rubyist/&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="n">d</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Dir:/users/caven/rubyist/&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>The most common and useful Dir-related technique is iteration through the entries (files, links, other directories) in a directory.</p>

<p>Dir ç›¸å…³æ“ä½œä¸­æœ€å¸¸ç”¨çš„æ˜¯æ‹¿åˆ°é‡Œé¢çš„å†…å®¹è¿›è¡Œ è¿­ä»£æ“ä½œ</p>

<p>æœ‰ä¸¤ä¸ªæ–¹æ³•</p>

<p><code class="highlighter-rouge">.entries</code></p>

<p><code class="highlighter-rouge">glob</code></p>

<p>åŒºåˆ«æ˜¯ glob ä¸ä¼šæ‹¿åˆ°è·¯å¾„ä¸­çš„ éšè—æ–‡ä»¶ï¼Œåœ¨ UNIX-like ç³»ç»Ÿä¸­å°±æ˜¯ä»¥ç‚¹å·èµ·å¤´çš„æ–‡ä»¶å¤¹ â€˜ . â€™ï¼Œ æ¯”å¦‚ .git è¿™ç±»ã€‚</p>

<p>.entries çš„ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ instance method æ ¼å¼ï¼Œä¸€ç§æ˜¯ class method æ ¼å¼</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="n">dir</span> <span class="o">=</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'/Users/caven/Notes &amp; Articles/Note of Rubyist'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;Dir:/Users/caven/Notes &amp; Articles/Note of Rubyist&gt;</span>

<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span> <span class="n">dir</span><span class="p">.</span><span class="nf">entries</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">".."</span><span class="p">,</span> <span class="s2">"Chapter 3 Organizing objects with classes.md"</span><span class="p">,</span> <span class="s2">"Chapter 14. Callable and runnable objects.md"</span><span class="p">,</span> <span class="s2">"Chapter 15. Callbacks, hooks, and runtime introspection.md"</span><span class="p">,</span> <span class="s2">".DS_Store"</span><span class="p">,</span> <span class="s2">"Chapter 2  Objects , methods, and local variables.md"</span><span class="p">,</span> <span class="s2">"chapter 12. File and I O operations.md"</span><span class="p">,</span> <span class="s2">"Chapter 8. Strings, symbols, and other scalar objects.md"</span><span class="p">,</span> <span class="s2">"Chapter 13. Object individuation.md"</span><span class="p">,</span> <span class="s2">"readme.md"</span><span class="p">,</span> <span class="s2">"Chapter 5 The default object (self), scope, and visibility.md"</span><span class="p">,</span> <span class="s2">"Chapter 11. Regular expressions and regexp-based string operations.md"</span><span class="p">,</span> <span class="s2">"Chapter 9 Collection and container objects.md"</span><span class="p">,</span> <span class="s2">"Chapter 7 Built-in essentials.md"</span><span class="p">,</span> <span class="s2">"Chapter 10 Collection central- Enumerable and Enumerator.md"</span><span class="p">,</span> <span class="s2">"Chapter 6 Control-flow techniques.md"</span><span class="p">,</span> <span class="s2">"Chapter 4 modules and program organization.md"</span><span class="p">,</span> <span class="s2">"code examples"</span><span class="p">,</span> <span class="s2">"Chapter 1  Bootstrapping your ruby literacy.md"</span><span class="p">]</span>

<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">006</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">entries</span><span class="p">(</span><span class="s1">'/Users/caven/Notes &amp; Articles/Note of Rubyist'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">".."</span><span class="p">,</span> <span class="s2">"Chapter 3 Organizing objects with classes.md"</span><span class="p">,</span> <span class="s2">"Chapter 14. Callable and runnable objects.md"</span><span class="p">,</span> <span class="s2">"Chapter 15. Callbacks, hooks, and runtime introspection.md"</span><span class="p">,</span> <span class="s2">".DS_Store"</span><span class="p">,</span> <span class="s2">"Chapter 2  Objects , methods, and local variables.md"</span><span class="p">,</span> <span class="s2">"chapter 12. File and I O operations.md"</span><span class="p">,</span> <span class="s2">"Chapter 8. Strings, symbols, and other scalar objects.md"</span><span class="p">,</span> <span class="s2">"Chapter 13. Object individuation.md"</span><span class="p">,</span> <span class="s2">"readme.md"</span><span class="p">,</span> <span class="s2">"Chapter 5 The default object (self), scope, and visibility.md"</span><span class="p">,</span> <span class="s2">"Chapter 11. Regular expressions and regexp-based string operations.md"</span><span class="p">,</span> <span class="s2">"Chapter 9 Collection and container objects.md"</span><span class="p">,</span> <span class="s2">"Chapter 7 Built-in essentials.md"</span><span class="p">,</span> <span class="s2">"Chapter 10 Collection central- Enumerable and Enumerator.md"</span><span class="p">,</span> <span class="s2">"Chapter 6 Control-flow techniques.md"</span><span class="p">,</span> <span class="s2">"Chapter 4 modules and program organization.md"</span><span class="p">,</span> <span class="s2">"code examples"</span><span class="p">,</span> <span class="s2">"Chapter 1  Bootstrapping your ruby literacy.md"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>Note that the single- and double-dot entries (current directory and parent directory, respectively) are present, as is the hidden .document entry. If you want to iterate through the entries, only processing files, you need to make sure you filter out the names starting with dots.
Letâ€™s say we want to add up the sizes of all non-hidden regular files in a directory. Hereâ€™s a first iteration (weâ€™ll develop a shorter one later):</p>

<p>æ³¨æ„è¿”å›æ–‡ä»¶å¤¹array ä¸­ï¼Œä¸€ä¸ªç‚¹å·å’Œ ä¸¤ä¸ªç‚¹å·çš„é¡¹ã€‚</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">entries</span><span class="p">(</span><span class="s1">'/users/'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">".."</span><span class="p">,</span> <span class="s2">".localized"</span><span class="p">,</span> <span class="s2">"Shared"</span><span class="p">,</span> <span class="s2">"caven"</span><span class="p">,</span> <span class="s2">"Guest"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>ç°åœ¨å¦‚æœæˆ‘ä»¬æƒ³è¦æŠŠæ‰€æœ‰ééšè—çš„å¸¸è§„æ–‡ä»¶ï¼ˆä¸æ˜¯æ–‡ä»¶å¤¹ï¼‰å¤§å°åŠ æ€»èµ·æ¥</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">=&gt;</span> <span class="c1">#&lt;Dir:/users&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">023</span> <span class="o">&gt;</span> <span class="n">entries</span> <span class="o">=</span> <span class="n">d</span><span class="p">.</span><span class="nf">entries</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">".."</span><span class="p">,</span> <span class="s2">".localized"</span><span class="p">,</span> <span class="s2">"Shared"</span><span class="p">,</span> <span class="s2">"caven"</span><span class="p">,</span> <span class="s2">"Guest"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">024</span> <span class="o">&gt;</span> <span class="n">entries</span><span class="p">.</span><span class="nf">delete_if</span> <span class="p">{</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span> <span class="n">entry</span> <span class="o">=~</span> <span class="sr">/^\./</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"Shared"</span><span class="p">,</span> <span class="s2">"caven"</span><span class="p">,</span> <span class="s2">"Guest"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">025</span> <span class="o">&gt;</span> <span class="n">entries</span><span class="p">.</span><span class="nf">map!</span> <span class="p">{</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span> <span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="nf">path</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"/users/Shared"</span><span class="p">,</span> <span class="s2">"/users/caven"</span><span class="p">,</span> <span class="s2">"/users/Guest"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">026</span> <span class="o">&gt;</span> <span class="n">entries</span><span class="p">.</span><span class="nf">delete_if</span> <span class="p">{</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span> <span class="o">!</span><span class="no">File</span><span class="p">.</span><span class="nf">file?</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="p">[]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">027</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="n">entries</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">acc</span><span class="p">,</span> <span class="n">entry</span><span class="o">|</span> <span class="n">acc</span> <span class="o">+</span> <span class="no">File</span><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="p">}</span>
<span class="mi">0</span>    <span class="c1"># cause we got an empty array in the previous step</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</code></pre></div></div>

<p>ç¬¬ä¸€ä¸ª delete_if ç§»é™¤æ‰äº†ä»¥ ç‚¹å·å¼€å¤´çš„æ–‡ä»¶
map! + File.joinæ˜¯ä¸ºäº†è®© array ä¸­çš„æ¯ä¸ªé¡¹éƒ½å˜æˆç»å¯¹è·¯å¾„ï¼Œæ–¹ä¾¿åé¢è®¡ç®—å¤§å°</p>

<p>è‹¥ä½¿ç”¨ glob å¯ä»¥ç®€åŒ–ä»£ç </p>

<p>Globbing in Ruby takes its semantics largely from shell globbing, the syntax that lets you do things like this in the shell:</p>

<p>Ruby ä¸­çš„globbingæ“ä½œä» shell ä¸­å€Ÿç”¨äº†å¾ˆå¤šè¯­ä¹‰</p>

<p>åƒè¿™ç±» * æ˜Ÿå·çš„ä½¿ç”¨</p>

<p><code class="highlighter-rouge">ls *.rb</code></p>

<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fochwzozavj30k803rdgm.jpg" alt="" /></p>

<p>The details differ from one shell to another, of course; but the point is that this whole family of name-expansion techniques is where Ruby gets its globbing syntax. An asterisk represents a wildcard match on any number of characters; a question mark represents one wildcard character. Regexp-style character classes are available for matching.</p>

<p>ä¸åŒçš„ shell ä¸­å¯èƒ½ç»†èŠ‚ä¸Šæœ‰åŒºåˆ«ï¼Œä½†æ ¸å¿ƒæ˜¯ ruby å€Ÿç”¨äº†è¿™äº›è¯­ä¹‰ä¸­çš„å¾ˆå¤šå†…å®¹ï¼Œ* æ˜Ÿå·ä»£è¡¨ä»»æ„æ•°ç›®çš„ä»»æ„å­—ç¬¦ï¼Œé—®å·ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼Œå’Œ regexp ä¸­æœ‰æ‰€åŒºåˆ«</p>

<p>To glob a directory, you can use the Dir.glob method or Dir.[] (square brackets). The square-bracket version of the method allows you to use index-style syntax, as you would with the square-bracket method on an array or hash. You get back an array containing the result set:</p>

<p>ä½¿ç”¨Dirçš„ <code class="highlighter-rouge">.[ ]</code> æˆ– <code class="highlighter-rouge">.glob</code> æ–¹æ³•å¯ä»¥ æ‹¿åˆ°åŒ¹é…çš„æ–‡ä»¶å¯¹è±¡array</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">[</span><span class="s1">'./*tion.rb'</span><span class="p">]</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"./enum_protection.rb"</span><span class="p">,</span> <span class="s2">"./partition.rb"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>å¦ä¸€ç§ å°±æ˜¯ä½¿ç”¨ Dir.glob( ) , glob ä¸ .[ ] ä¸åŒçš„æ˜¯ glob( ) ä¸ä»…å¯ä»¥åŒ¹é…æ–‡ä»¶è·¯å¾„ï¼Œè¿˜å¯ä»¥ç»™å‡ºé€‰é¡¹ flag è¿‡æ»¤ç»“æœã€‚</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="s1">'*info*'</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="s1">'*info*'</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">FNM_DOTMATCH</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">".information"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="s1">'*info*'</span><span class="p">,</span> <span class="no">File</span><span class="o">::</span><span class="no">FNM_DOTMATCH</span> <span class="o">|</span> <span class="no">File</span><span class="o">::</span><span class="no">FNM_CASEFOLD</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">".information"</span><span class="p">,</span> <span class="s2">"Info"</span><span class="p">,</span> <span class="s2">".INFO"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>ä¸€ä¸ªå‚æ•°ä½œä¸ºåŒ¹é…å­—ç¬¦ï¼Œåé¢çš„åˆ™æ˜¯è¿‡æ»¤é€‰é¡¹</p>

<p>The flags are, literally, numbers. The value of File::FNM_DOTMATCH, for example, is 4. The specific numbers donâ€™t matter (they derive ultimately from the flags in the system library function fnmatch). What does matter is the fact that theyâ€™re exponents of two accounts for the use of the OR operation to combine them.</p>

<p>File::FNM_DOTMATCH å’Œ File::FNM_CASEFOLD éƒ½æ˜¯ç³»ç»Ÿåº“ä¸­çš„é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥ç”¨æ•°å­—ä»£è¡¨</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="s1">'*info*'</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">".information"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span>
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>Flags é€‰é¡¹ä¹‹é—´è¿˜å¯ä»¥ä½¿ç”¨ ç«–çº¿</td>
      <td>æ·»åŠ é€‰é¡¹ï¼Œ è¯­ä¹‰ä¸Šæ˜¯ or</td>
    </tr>
  </tbody>
</table>

<p>-</p>

<p>As you can see from the first two lines of the previous example, a glob operation on a directory can find nothing and still not complain. It gives you an empty array. Not finding anything isnâ€™t considered a failure when youâ€™re globbing.</p>

<p>éœ€è¦æ³¨æ„ ä½¿ç”¨ Dir.glob å’Œ Dir[ ] æ–¹æ³•å¦‚æœæ²¡æœ‰åŒ¹é…è¿”å›çš„æ˜¯ç©º array å¯¹è±¡ï¼Œè€Œä¸æ˜¯ nil å¦‚æœè¦å°†åŒ¹é…ç»“æœä½œä¸ºbooleané€»è¾‘åˆ¤æ–­éœ€è¦å°å¿ƒ</p>

<p>â€”</p>

<p>å¦‚æœä¸éœ€è¦ flags æ¥è¿›è¡Œè¿‡æ»¤é‚£ä¹ˆä½¿ç”¨ Dir[ ] å’Œ Dir.glob æ•ˆæœæ˜¯å·®ä¸å¤šçš„ï¼Œé™¤éä½ éœ€è¦æ›´ç²¾ç»†çš„åŒ¹é…ï¼Œå¤šæ•°ç®€å•æƒ…å†µå¯ä»¥ç›´æ¥ä½¿ç”¨ Dir[ ]</p>

<p>å› ä¸º Dirç›¸å…³çš„æ–¹æ³•é»˜è®¤ä¸åŒ…å«ä»¥ç‚¹å· . å¼€å¤´çš„éšè—æ–‡ä»¶ï¼Œæ‰€ä»¥å¯¹åº”åˆ°ä¸Šé¢æåˆ°çš„ä½¿ç”¨ entries è®¡ç®—ééšè—å¸¸è§„æ–‡ä»¶å¤§å°çš„æ“ä½œå¯ä»¥ç®€åŒ–</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span> <span class="n">dir</span> <span class="o">=</span> <span class="s1">'/users/caven/'</span>
 <span class="o">=&gt;</span> <span class="s2">"/users/caven/"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">entries</span> <span class="o">=</span> <span class="no">Dir</span><span class="p">[</span><span class="s2">"</span><span class="si">#{</span><span class="n">dir</span><span class="si">}</span><span class="s2">/*"</span><span class="p">].</span><span class="nf">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span> <span class="no">File</span><span class="p">.</span><span class="nf">directory?</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="p">}</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"/Users/caven//Reading"</span><span class="p">,</span> <span class="s2">"/Users/caven//Music"</span><span class="p">,</span> <span class="s2">"/Users/caven//CavenHome"</span><span class="p">,</span> <span class="s2">"/Users/caven//Calibre ä¹¦åº“"</span><span class="p">,</span> <span class="s2">"/Users/caven//rubyist"</span><span class="p">,</span><span class="o">......</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">010</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="n">entries</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">acc</span><span class="p">,</span> <span class="n">entry</span><span class="o">|</span> <span class="n">acc</span> <span class="o">+</span> <span class="no">File</span><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="p">}</span>
<span class="mi">13504</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">011</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>ä½¿ç”¨ Dir çš„æ–¹æ³•å°‘äº† å°†ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„çš„æ­¥éª¤ï¼Œè¿˜æœ‰è¿‡æ»¤éšè—æ–‡ä»¶çš„æ­¥éª¤</p>

<p>â€”</p>

<p>Directory manipulation and querying</p>

<p>â€”</p>

<p>Here, weâ€™ll create a new directory (mkdir), navigate to it (chdir), add and examine a file, and delete the directory (rmdir):â€</p>

<p>ä¸‹é¢æˆ‘ä»¬ä¼šæ–°å»º<code class="highlighter-rouge">mkdir</code>ä¸€ä¸ªè·¯å¾„ï¼Œç„¶ååˆ‡æ¢<code class="highlighter-rouge">chdir</code>åˆ°è¿™ä¸ªè·¯å¾„ï¼ŒåŠ å…¥å¹¶æ£€è§†ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶ååˆ é™¤<code class="highlighter-rouge">rmdir</code>è¿™ä¸ªè·¯å¾„</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">01</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">new_dir</span> <span class="o">=</span> <span class="s1">'/tmp/newdir'</span>
 <span class="o">=&gt;</span> <span class="s2">"/tmp/newdir"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">01</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">newfile</span> <span class="o">=</span> <span class="s1">'newfile'</span>
 <span class="o">=&gt;</span> <span class="s2">"newfile"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">020</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">021</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">chdir</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span> <span class="k">do</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">022</span> <span class="o">&gt;</span>     <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">newfile</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">023</span> <span class="o">&gt;</span>       <span class="n">f</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"Sample file in new directory"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">024</span><span class="p">?</span><span class="o">&gt;</span>     <span class="k">end</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">025</span><span class="p">?</span><span class="o">&gt;</span>   <span class="nb">puts</span> <span class="s2">"Current directory: </span><span class="si">#{</span><span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span><span class="si">}</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">026</span><span class="p">?</span><span class="o">&gt;</span>   <span class="nb">p</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">entries</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">027</span><span class="p">?</span><span class="o">&gt;</span>   <span class="no">File</span><span class="p">.</span><span class="nf">unlink</span><span class="p">(</span><span class="n">newfile</span><span class="p">)</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">02</span><span class="mi">8</span><span class="p">?</span><span class="o">&gt;</span> <span class="k">end</span>
<span class="no">Current</span> <span class="ss">directory: </span><span class="sr">/private/</span><span class="n">tmp</span><span class="o">/</span><span class="n">newdir</span>
<span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">".."</span><span class="p">,</span> <span class="s2">"newfile"</span><span class="p">]</span>
 <span class="o">=&gt;</span> <span class="mi">1</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">02</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">rmdir</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">030</span> <span class="o">&gt;</span> <span class="nb">print</span> <span class="s2">"Does </span><span class="si">#{</span><span class="n">new_dir</span><span class="si">}</span><span class="s2"> still exist?"</span>
<span class="no">Does</span> <span class="sr">/tmp/ne</span><span class="n">wdir</span> <span class="n">still</span> <span class="n">exist?</span> <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">031</span> <span class="o">&gt;</span> <span class="k">if</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">032</span><span class="p">?</span><span class="o">&gt;</span>   <span class="nb">puts</span> <span class="s2">"Yes"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">033</span><span class="p">?</span><span class="o">&gt;</span> <span class="k">else</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">034</span><span class="p">?</span><span class="o">&gt;</span>   <span class="nb">puts</span> <span class="s2">"No"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">035</span><span class="p">?</span><span class="o">&gt;</span> <span class="k">end</span>
<span class="no">No</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">036</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>ä¾‹å­ä¸­ä½¿ç”¨åˆ°çš„æ–¹æ³•éƒ½è·Ÿshell ä¸­å¾ˆåƒï¼Œ æ¯”å¦‚ Dir.mkdir å¯¹åº” make directory, chdir å¯¹åº” change directory , rmdir å¯¹åº” remove directory</p>

<p>unlink  æ–¹æ³• å…¶å®å°±æ˜¯ delete æ–¹æ³• åˆ é™¤</p>

<p>As promised in the introduction to this chapter, weâ€™ll now look at some standard library facilities for manipulating and handling files.</p>

<p>ä¸‹é¢æˆ‘ä»¬ä¼šçœ‹ä¸€äº› standard library ä¸­å¤„ç†æ–‡ä»¶çš„åŠŸèƒ½</p>

<p>-</p>

<p><strong>File tools from the standard library</strong></p>

<p>std lib ä¸­çš„æ–‡ä»¶å¤„ç†å·¥å…·</p>

<p>-</p>

<p>File handling is an area where the standard libraryâ€™s offerings are particularly rich. Accordingly, weâ€™ll delve into those offerings more deeply here than anywhere else in the book. This isnâ€™t to say that the rest of the standard library isnâ€™t worth getting to know, but that the extensions available for file manipulation are so central to how most people do file manipulation in Ruby that you canâ€™t get a firm grounding in the process without them.</p>

<p>Weâ€™ll look at the versatile FileUtils package first and then at the more specialized but useful Pathname class. Next youâ€™ll meet StringIO, a class whose objects are, essentially, strings with an I/O interface; you can rewind them, seek through them, getc from them, and so forth. Finally, weâ€™ll explore open-uri, a package that lets you â€œopenâ€ URIs and read them into strings as easily as if they were local files.</p>

<p>Standard lib ä¸­å°¤å…¶æä¾›äº†å¾ˆå¤šå…³äºæ–‡ä»¶çš„æ“ä½œï¼Œå› æ­¤è¿™éƒ¨åˆ†ä¼šæ˜¯æœ¬ä¹¦ä¸­æœ€æ·±å…¥ standard lib çš„å†…å®¹ã€‚ä½†è¿™å¹¶ä¸æ˜¯è¯´standard lib çš„å…¶ä»–éƒ¨åˆ†å†…å®¹ä¸é‡è¦ã€‚åªä¸è¿‡è¿™éƒ¨åˆ†å…³äºæ–‡ä»¶æ“ä½œçš„å†…å®¹å¾ˆæ ¸å¿ƒä¹Ÿå¾ˆé‡è¦ï¼Œå¦‚æœä¸ä»‹ç»ä»–ä»¬ï¼Œæˆ‘ä»¬å…³äºæ–‡ä»¶æ“ä½œå†…å®¹çš„å­¦ä¹ å°±ç§°ä¸ä¸Šæœ‰è¾ƒå¥½çš„åŸºç¡€ã€‚
æˆ‘ä»¬ä¼šå­¦ä¹  åŠŸèƒ½é½å…¨çš„ FileUtils åº“ï¼Œä»¥åŠæ¯”è¾ƒç‰¹åŒ–çš„ class Pathname
ç„¶åä¼šå­¦ä¹  StringIO, è¿™ä¸ª class çš„å®ä¾‹å¯¹è±¡å®é™…ä¸Šæ˜¯ å¸¦æœ‰ I / O æ¥å£çš„ string å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œ rewind ï¼Œ seek , getc ç­‰æ“ä½œ</p>

<p>æœ€åæˆ‘ä»¬å°†ä¼šæ¢ç´¢ open-uri ï¼Œè¿™ä¸ªåº“è®©æˆ‘ä»¬èƒ½æ›´å¥½çš„ä»¥ string çš„æ–¹å¼å¤„ç† URIs</p>

<p>â€”</p>

<p>The FileUtils module</p>

<p>â€”</p>

<p>FileUtils ä¸­çš„å¾ˆå¤šæ–¹æ³•ä¹Ÿæ˜¯ä» UNIX-like ç³»ç»Ÿä¸­å€Ÿé‰´è€Œæ¥çš„æ¯”å¦‚</p>

<p><code class="highlighter-rouge">FileUtils.rm_rf</code> æ¨¡ä»¿  rm -rf (force unconditional recursive removal of a file or directory)</p>

<p>You can create a symbolic link from filename to linkname with <code class="highlighter-rouge">FileUtils.ln_s(filename, linkname)</code>, much in the manner of the ln -s command.</p>

<p>copying, moving, and deleting files</p>

<p>FileUtils provides several concise, high-level methods for these operations. The cp method emulates the traditional UNIX method of the same name. You can cp one file to another or several files to a directory:</p>

<p>FileUtils æä¾›äº†å¾ˆå¤šç®€æ´ï¼Œé«˜å±‚åŠçš„æ–¹æ³•ã€‚æ¯”å¦‚ <code class="highlighter-rouge">cp</code> æ–¹æ³•å°±æ¨¡ä»¿äº†åŒåç§°çš„ä¼ ç»Ÿçš„ UNIX æ–¹æ³•ã€‚ä½ å¯ä»¥ <code class="highlighter-rouge">cp</code> ä¸€ä¸ªæ–‡ä»¶åˆ°å¦ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åˆ°ä¸€ä¸ªè·¯å¾„ä¸­</p>

<p>æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­</p>

<p>cp æ‹·è´ä¸€ä¸ªæ–‡ä»¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶(å¹¶ä¸”æ›´æ”¹äº†æ–‡ä»¶åç¼€å)</p>

<p>mkdir æ–°å»ºäº†æ–‡ä»¶å¤¹</p>

<p>è¿™äº›ç”¨æ³•éƒ½å’Œ unix ç³»ç»Ÿä¸­çš„æ“ä½œå¾ˆç±»ä¼¼</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">041</span> <span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">'fileutils'</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">042</span> <span class="o">&gt;</span> <span class="no">FileUtils</span><span class="p">.</span><span class="nf">cp</span><span class="p">(</span><span class="s2">"baker.rb"</span><span class="p">,</span> <span class="s2">"baker.rb.bak"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">043</span> <span class="o">&gt;</span> <span class="no">FileUtils</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="s2">"backup"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"backup"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">044</span> <span class="o">&gt;</span> <span class="no">FileUtils</span><span class="p">.</span><span class="nf">cp</span><span class="p">([</span><span class="s2">"ensure.rb"</span><span class="p">,</span> <span class="s2">"super.rb"</span><span class="p">],</span> <span class="s2">"backup"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"ensure.rb"</span><span class="p">,</span> <span class="s2">"super.rb"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">045</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">[</span><span class="s2">"backup/*"</span><span class="p">]</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"backup/super.rb"</span><span class="p">,</span> <span class="s2">"backup/ensure.rb"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">046</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>æ³¨æ„åœ¨ terminal ä¸­ï¼ˆä¸æ˜¯åœ¨irbï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ mkdir, cd ç­‰æ“ä½œæ˜¯åœ¨ç”µè„‘çš„ç³»ç»Ÿå±‚é¢ä¸Šï¼Œè€Œè¿™é‡Œæåˆ°çš„å…³äºæ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯åœ¨ ruby è¿™ä¸ªå¤§èƒŒæ™¯ä¸‹çš„ï¼Œä¸è¦æ··æ·†èŒƒå›´ã€‚</p>

<p>å¯¹åº”çš„ è¿˜æœ‰ mv ç”¨æ¥ç§»åŠ¨æ–‡ä»¶ï¼Œrmç”¨æ¥åˆ é™¤æ–‡ä»¶</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">046</span> <span class="o">&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">047</span> <span class="o">&gt;</span> <span class="no">FileUtils</span><span class="p">.</span><span class="nf">mv</span><span class="p">(</span><span class="s2">"baker.rb.bak"</span><span class="p">,</span> <span class="s2">"backup"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">04</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="no">Dir</span><span class="p">[</span><span class="s2">"backup/*"</span><span class="p">]</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"backup/super.rb"</span><span class="p">,</span> <span class="s2">"backup/baker.rb.bak"</span><span class="p">,</span> <span class="s2">"backup/ensure.rb"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">04</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="s2">"backup/super.rb"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">050</span> <span class="o">&gt;</span> <span class="no">FileUtils</span><span class="p">.</span><span class="nf">rm</span><span class="p">(</span><span class="s2">"backup/super.rb"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"backup/super.rb"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">051</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="s2">"backup/super.rb"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">false</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">052</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">rm_rf</code> method recursively and unconditionally removes a directory:â€</p>

<p>rm_rf ç”¨æ¥æ— æ¡ä»¶åˆ é™¤æ–‡ä»¶</p>

<p>æ³¨æ„ç”¨æ¥æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨çš„ exist? æ˜¯ File(core) ä¸­çš„ æ–¹æ³•</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">052</span> <span class="o">&gt;</span> <span class="no">FileUtils</span><span class="p">.</span><span class="nf">rm_rf</span><span class="p">(</span><span class="s2">"backup"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"backup"</span><span class="p">]</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">053</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="s2">"backup"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">false</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">054</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>FileUtils gives you a useful toolkit for quick and easy file maintenance. But it goes further: it lets you try commands without executing them.</p>

<p>FileUtils ä¸­é™¤äº†ä¸Šé¢æåˆ°çš„æ–¹æ³•ï¼Œè¿˜æœ‰è®©æˆ‘ä»¬ try ä¸€ä¸ªæ–¹æ³•è€Œä¸ç”¨å®é™…æ‰§è¡Œ</p>

<p>-</p>

<p>The DryRun and NoWrite modules</p>

<p>-</p>

<p>If you want to see what would happen if you were to run a particular FileUtils command, you can send the command to FileUtils::DryRun. The output of the method you call is a representation of a UNIX-style system command, equivalent to what youâ€™d get if you called the same method on FileUtils:</p>

<p>å¦‚æœä½ æƒ³çŸ¥é“æ‰§è¡Œä¸€ä¸ª FileUtils ä¸­çš„æ–¹æ³•å¯¹åº”çš„ UNIX æ ¼å¼(ä¹Ÿå¯ä»¥ç†è§£ä¸ºåœ¨terminalä¸­)æ˜¯æ€æ ·çš„ï¼Œä½ å°†ä¸€ä¸ªå‘½ä»¤ä½œä¸ºå‚æ•°é€ç»™ FileUtils::DryRun, å°†ä¼šè¿”å›ä½ æ‰§è¡Œæ–¹æ³•çš„ UNIX æ ¼å¼</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">056</span> <span class="o">&gt;</span> <span class="no">FileUtils</span><span class="o">::</span><span class="no">DryRun</span><span class="p">.</span><span class="nf">rm_rf</span><span class="p">(</span><span class="s2">"filename"</span><span class="p">)</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">filename</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">057</span> <span class="o">&gt;</span> <span class="no">FileUtils</span><span class="o">::</span><span class="no">DryRun</span><span class="p">.</span><span class="nf">ln_s</span><span class="p">(</span><span class="s2">"backup"</span><span class="p">,</span> <span class="s2">"backup_link"</span><span class="p">)</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="n">backup</span> <span class="n">backup_link</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">05</span><span class="mi">8</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>If you want to make sure you donâ€™t accidentally delete, overwrite, or move files, you can give your commands to FileUtils::NoWrite, which has the same interface as FileUtils but doesnâ€™t perform any disk-writing operations:</p>

<p>åœ¨æ‰§è¡Œä¸€ä¸ªåŠ¨ä½œå‰å¦‚æœä½ æ€•å¼•èµ·æ— æ³•é€†è½¬çš„åæœï¼Œå¯ä»¥åœ¨ FileUtils::NoWriteåæ‰§è¡Œä½ æƒ³æ‰§è¡Œçš„å‘½ä»¤ï¼Œè¿™æ ·ä½ å¯ä»¥çœ‹åˆ°æ¨¡æ‹Ÿçš„ç»“æœè€Œä¸ä¼šè¿›è¡Œå®é™…çš„è¯»å†™</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">060</span> <span class="o">&gt;</span> <span class="no">FileUtils</span><span class="o">::</span><span class="no">NoWrite</span><span class="p">.</span><span class="nf">rm</span><span class="p">(</span><span class="s2">"/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/.INFO"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">061</span> <span class="o">&gt;</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="s2">"/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/.INFO"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">062</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>â€”-</p>

<p><strong>The Pathname class</strong></p>

<p>â€”-</p>

<p>The Pathname class lets you create Pathname objects and query and manipulate them so you can determine, for example, the basename and extension of a pathname, or iterate through the path as it ascends the directory structure.</p>

<p>Pathname ç±»è®©ä½ å¯ä»¥å»ºç«‹æ–°çš„ pathname å¯¹è±¡ï¼Œç„¶åå¯¹å…¶è¿›è¡ŒæŸ¥è¯¢å’Œæ“ä½œï¼Œæ¯”å¦‚ä¸€ä¸ªè·¯å¾„çš„å½“å‰è·¯å¾„åç§°ä»¥åŠæ‹“å±•åç­‰ï¼Œæˆ–è€…æ²¿ç€è¿™ä¸ªè·¯å¾„å‘ä¸Šè¿›è¡Œè¿­ä»£æ“ä½œ</p>

<p>Pathname objects also have a large number of methods that are proxied from File, Dir, IO, and other classes. We wonâ€™t look at those methods here; weâ€™ll stick to the ones that are uniquely Pathnameâ€™s.</p>

<p>Pathnameå¯¹è±¡åŒæ—¶è¿˜æœ‰å¾ˆå¤šæ–¹æ³•æ˜¯ä» Fileï¼Œ Dir, IO ä»¥åŠå…¶ä»–classesä¸­å€Ÿæ¥çš„ã€‚ æˆ‘ä»¬è¿™é‡Œä¸ä¼šæåˆ°ï¼Œæˆ‘ä»¬åªæé‚£äº›åªåœ¨ Pathnameä¸­æ‰æœ‰çš„æ–¹æ³•ã€‚</p>

<p>è®°å¾—å…ˆ  <code class="highlighter-rouge">require 'pathname'</code></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">062</span> <span class="o">&gt;</span> <span class="n">path</span> <span class="o">=</span> <span class="no">Pathname</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/.INFO"</span><span class="p">)</span>
<span class="no">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
        <span class="mi">2</span><span class="p">:</span> <span class="n">from</span> <span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="p">.</span><span class="nf">rvm</span><span class="o">/</span><span class="n">rubies</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">irb</span><span class="p">:</span><span class="mi">11</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;'
        1: from (irb):62
NameError (uninitialized constant Pathname)
2.5.0 :063 &gt; require 'pathname'
 =&gt; true
2.5.0 :064 &gt; path = Pathname.new("/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/.INFO")
 =&gt; #&lt;Pathname:/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/.INFO&gt;
2.5.0 :065 &gt; path.basename
 =&gt; #&lt;Pathname:.INFO&gt;
2.5.0 :066 &gt; path.dirname
 =&gt; #&lt;Pathname:/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples&gt;
2.5.0 :067 &gt; path.extname
 =&gt; ""
2.5.0 :068 &gt; path
 =&gt; #&lt;Pathname:/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples/.INFO&gt;
2.5.0 :069 &gt;
</span></code></pre></div></div>

<p>å¯¹ä¸€ä¸ª Pathname å¯¹è±¡ä½¿ç”¨æŸäº›æ–¹æ³• è¿”å›çš„å€¼æ˜¯ä¸€ä¸ª æ–°çš„Pathname å¯¹è±¡ï¼Œ å¦‚æœæƒ³è¦çœ‹ string æ ¼å¼çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ puts åŠ å¯¹è±¡</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">076</span> <span class="o">&gt;</span> <span class="n">path</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;Pathname:/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">077</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="n">path</span>
<span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="no">Notes</span> <span class="o">&amp;</span> <span class="no">Articles</span><span class="o">/</span><span class="no">Note</span> <span class="n">of</span> <span class="no">Rubyist</span><span class="o">/</span><span class="n">code</span> <span class="n">examples</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">07</span><span class="mi">8</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>The Pathname object can also walk up its file and directory structure, truncating itself from the right on each iteration, using the ascend method and a code block:</p>

<p><code class="highlighter-rouge">ascend</code> æ–¹æ³•å¯ä»¥ä»å½“å‰è·¯å¾„å¼€å§‹ï¼Œä¸€çº§ä¸€çº§åœ°å‘ä¸Šéå†æ¯ä¸€ä¸ªè·¯å¾„</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">07</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">path</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;Pathname:/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mi">080</span> <span class="o">&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mi">081</span> <span class="o">&gt;</span> <span class="n">path</span><span class="p">.</span><span class="nf">ascend</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mi">082</span> <span class="o">&gt;</span>     <span class="nb">puts</span> <span class="s2">"Next level up: </span><span class="si">#{</span><span class="n">dir</span><span class="si">}</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mi">083</span><span class="p">?</span><span class="o">&gt;</span>   <span class="k">end</span>
<span class="no">Next</span> <span class="n">level</span> <span class="ss">up: </span><span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="no">Notes</span> <span class="o">&amp;</span> <span class="no">Articles</span><span class="o">/</span><span class="no">Note</span> <span class="n">of</span> <span class="no">Rubyist</span><span class="o">/</span><span class="n">code</span> <span class="n">examples</span>
<span class="no">Next</span> <span class="n">level</span> <span class="ss">up: </span><span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="no">Notes</span> <span class="o">&amp;</span> <span class="no">Articles</span><span class="o">/</span><span class="no">Note</span> <span class="n">of</span> <span class="no">Rubyist</span>
<span class="no">Next</span> <span class="n">level</span> <span class="ss">up: </span><span class="sr">/Users/</span><span class="n">caven</span><span class="o">/</span><span class="no">Notes</span> <span class="o">&amp;</span> <span class="no">Articles</span>
<span class="no">Next</span> <span class="n">level</span> <span class="ss">up: </span><span class="sr">/Users/</span><span class="n">caven</span>
<span class="no">Next</span> <span class="n">level</span> <span class="ss">up: </span><span class="sr">/Users
Next level up: /</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mi">084</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>The key behavioral trait of Pathname objects is that they return other Pathname objects. That means you can extend the logic of your pathname operations without having to convert back and forth from pure strings. By way of illustration, hereâ€™s the last example again, but altered to take advantage of the fact that whatâ€™s coming through in the block parameter dir on each iteration isnâ€™t a string (even though it prints out like one) but a Pathname object:</p>

<p>å…³äº Pathname çš„ä¸€ä¸ªä¸»è¦ç‰¹ç‚¹æ˜¯ä¸Šé¢æåˆ°çš„ä»–æ€»æ˜¯è¿”å›ä¸€ä¸ª object è€Œä¸æ˜¯ä¸€ä¸ª string ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ block ä¸­è¿ç»­ä½¿ç”¨é’ˆå¯¹ object çš„æ–¹æ³•</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mi">085</span> <span class="o">&gt;</span> <span class="n">path</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;Pathname:/Users/caven/Notes &amp; Articles/Note of Rubyist/code examples&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mi">086</span> <span class="o">&gt;</span> <span class="n">path</span><span class="p">.</span><span class="nf">ascend</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mi">087</span> <span class="o">&gt;</span>     <span class="nb">puts</span> <span class="s2">"Ascended to </span><span class="si">#{</span><span class="n">dir</span><span class="p">.</span><span class="nf">basename</span><span class="si">}</span><span class="s2">"</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mi">088</span><span class="p">?</span><span class="o">&gt;</span>   <span class="k">end</span>
<span class="no">Ascended</span> <span class="n">to</span> <span class="n">code</span> <span class="n">examples</span>
<span class="no">Ascended</span> <span class="n">to</span> <span class="no">Note</span> <span class="n">of</span> <span class="no">Rubyist</span>
<span class="no">Ascended</span> <span class="n">to</span> <span class="no">Notes</span> <span class="o">&amp;</span> <span class="no">Articles</span>
<span class="no">Ascended</span> <span class="n">to</span> <span class="n">caven</span>
<span class="no">Ascended</span> <span class="n">to</span> <span class="no">Users</span>
<span class="no">Ascended</span> <span class="n">to</span> <span class="o">/</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mi">089</span> <span class="o">&gt;</span>
</code></pre></div></div>
<p>â€”</p>

<p>The StringIO class</p>

<p>â€”</p>

<p>The StringIO class allows you to treat strings like IO objects. You can seek through them, rewind them, and so forth.</p>

<p>StringIO class è®©æˆ‘ä»¬å¯ä»¥åƒå¯¹å¾… IO å¯¹è±¡ä¸€æ ·å¯¹å¾… string , å¯ä»¥seek , rewind, ç­‰ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯å®ä¾‹åŒ–IOå¯¹è±¡æ—¶ä¼ å…¥æ–‡ä»¶ï¼Œç„¶åå¯¹objectè¿›è¡Œçš„æ“ä½œ</p>

<p>å‡è®¾æˆ‘ä»¬ç°åœ¨æƒ³å†™ä¸€ä¸ª module ï¼Œä¸“é—¨ç”¨æ¥å°†ä¸€ä¸ªæ–‡ä»¶ä¸­ä¸æ˜¯æ³¨é‡Šï¼ˆä¸ä»¥<code class="highlighter-rouge">#</code>å¼€å¤´ï¼‰çš„å†…å®¹å¯¼å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†™çš„ module å¯èƒ½æ˜¯è¿™æ ·ï¼š</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">DeCommenter</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">decomment</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">comment_re</span> <span class="o">=</span> <span class="sr">/\A\s*#/</span><span class="p">)</span>
    <span class="n">infile</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">inline</span><span class="o">|</span>
      <span class="n">outfile</span><span class="p">.</span><span class="nf">print</span> <span class="n">inline</span> <span class="k">unless</span> <span class="n">inline</span> <span class="o">=~</span> <span class="n">comment_re</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div></div>

<p>infile ä»£è¡¨åŸå§‹çš„é‚£ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œ outfile ä»£è¡¨å°†è¦å†™å…¥çš„æ–‡ä»¶å¯¹è±¡ï¼Œcomment_re æ˜¯é»˜è®¤çš„è¯†åˆ«æ³¨é‡Šçš„ regular expression</p>

<p>å¦‚æœä»¥ä¸Šé¢çš„ module ä¸ºåŸºç¡€ï¼Œæˆ‘ä»¬è¿›è¡Œçš„å®é™…æ“ä½œä¼šæ˜¯è¿™æ ·</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"myprogram.rb"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">infile</span><span class="o">|</span>
  <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"target.rb"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">outfile</span><span class="o">|</span>
    <span class="no">DeCommenter</span><span class="p">.</span><span class="nf">decomment</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span><span class="n">outfile</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>è¿™é‡Œå®é™…åšçš„å°±æ˜¯åˆ†åˆ«æ‹¿åˆ°ä¸¤ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œä¸€ä¸ªä½œä¸º æºï¼Œ ä¸€ä¸ªä½œä¸ºè¾“å‡ºå®¹å™¨ï¼Œç„¶åå°†ä½œä¸ºæºçš„å¯¹è±¡çš„è¿­ä»£ä¸­åŒ¹é…åˆ°çš„å†…å®¹å†™å…¥è¾“å‡ºå¯¹è±¡ã€‚</p>

<p>å®é™…æµ‹è¯•ä¸€ä¸‹ module DeCommenter</p>

<p>å…ˆå°† module æ”¾åˆ° decommenter.rb è¿™ä¸ªrbæ–‡ä»¶ä¸­</p>

<p><code class="highlighter-rouge">decommenter.rb</code></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">DeCommenter</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">decomment</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">comment_re</span> <span class="o">=</span> <span class="sr">/\A\s*#/</span><span class="p">)</span>
    <span class="n">infile</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">inline</span><span class="o">|</span>
      <span class="n">outfile</span><span class="p">.</span><span class="nf">print</span> <span class="n">inline</span> <span class="k">unless</span> <span class="n">inline</span> <span class="o">=~</span> <span class="n">comment_re</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div></div>

<p>ç„¶ååœ¨æ–‡ä»¶ decomment-demo.rb ä¸­å†™æµ‹è¯•</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'stringio'</span> <span class="c1"># standard lib</span>
<span class="nb">require_relative</span> <span class="s1">'decommenter'</span> <span class="c1"># module DeCommenter</span>

<span class="n">string</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="no">EOM</span><span class="sh">
# This is a comment.
This isn't a comment.
# This is.
    # So is this.
This is also not a comment.
</span><span class="no">EOM</span>

<span class="n">infile</span> <span class="o">=</span> <span class="no">StringIO</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="n">outfile</span> <span class="o">=</span> <span class="no">StringIO</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>

<span class="no">DeCommenter</span><span class="p">.</span><span class="nf">decomment</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
<span class="nb">puts</span> <span class="s2">"Test succeeded"</span> <span class="k">if</span> <span class="n">outfile</span><span class="p">.</span><span class="nf">string</span> <span class="o">==</span> <span class="o">&lt;&lt;</span><span class="no">EOM</span><span class="sh">
This isn't a comment.
This is also not a comment.
</span><span class="no">EOM</span>
</code></pre></div></div>

<p>é¦–å…ˆè¦ require ä¸¤ä¸ªéœ€è¦çš„åº“, æ˜¯ä¸ªæ˜¯ rubyçš„ â€˜stringioâ€™ï¼Œ ä¸€ä¸ªæ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„module</p>

<p>string åŒ…å«çš„å†…å®¹ è¢«æ³¨å…¥åˆ° infile è¿™ä¸ª StringIO å¯¹è±¡ä¸­ï¼Œ outfileå¯¹è±¡æ–°å»ºæ—¶ç”¨åˆ°äº†ç©ºå­—ç¬¦ä¸²</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="nb">load</span> <span class="s1">'./decomment-demo.rb'</span>
<span class="no">Test</span> <span class="n">succeeded</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>æœ€åè¿”å›çš„ç»“æœï¼Œæµ‹è¯•æˆåŠŸ</p>

<p>-</p>

<p>â€”-</p>

<p>The open-uri library</p>

<p>â€”-</p>

<p>The open-uri standard library package lets you retrieve information from the network using the HTTP and HTTPS protocols as easily as if you were reading local files. All you do is require the library (require â€˜open-uriâ€™) and use the Kernel#open method with a URI as the argument. You get back a StringIO object containing the results of your request:</p>

<p>open-uri åº“è®©æˆ‘ä»¬ç›´æ¥é€šè¿‡å‘½ä»¤ä»¥ http / https åè®®æ‹¿åˆ°èµ„æºä¿¡æ¯ï¼Œå°±åƒåœ¨è¯»å–ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶ä¸€æ ·</p>

<p>åœ¨require åº“ä¹‹åï¼Œä½¿ç”¨ <code class="highlighter-rouge">Kernel#open</code> æ–¹æ³•ä¼ å…¥URIåœ°å€ï¼Œå°±å¯ä»¥æ‹¿åˆ°ä¸€ä¸ª StringIO å¯¹è±¡åŒ…å«requstçš„å†…å®¹ã€‚</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="nb">require</span> <span class="s2">"open-uri"</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="n">rubypage</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"http://rubycentral.org"</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="c1">#&lt;StringIO:0x00007f97a5920920 @base_uri=#&lt;URI::HTTP http://rubycentral.org&gt;, @meta={"connection"=&gt;"keep-alive", "x-frame-options"=&gt;"sameorigin", "x-xss-protection"=&gt;"1; mode=block", "content-type"=&gt;"text/html;charset=utf-8", "content-length"=&gt;"6675", "server"=&gt;"WEBrick/1.3.1 (Ruby/2.1.3/2014-09-19)", "date"=&gt;"Sun, 11 Feb 2018 11:27:17 GMT", "via"=&gt;"1.1 vegur"}, @metas={"connection"=&gt;["keep-alive"], "x-frame-options"=&gt;["sameorigin"], "x-xss-protection"=&gt;["1; mode=block"], "content-type"=&gt;["text/html;charset=utf-8"], "content-length"=&gt;["6675"], "server"=&gt;["WEBrick/1.3.1 (Ruby/2.1.3/2014-09-19)"], "date"=&gt;["Sun, 11 Feb 2018 11:27:17 GMT"], "via"=&gt;["1.1 vegur"]}, @status=["200", "OK "]&gt;</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">005</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="n">rubypage</span><span class="p">.</span><span class="nf">gets</span>
<span class="o">&lt;!</span><span class="n">doctype</span> <span class="n">html</span><span class="o">&gt;</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">006</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="n">rubypage</span><span class="p">.</span><span class="nf">gets</span>
<span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"en"</span><span class="o">&gt;</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">007</span> <span class="o">&gt;</span> <span class="nb">puts</span> <span class="n">rubypage</span><span class="p">.</span><span class="nf">gets</span>
  <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span>
</code></pre></div></div>

<p>Require ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ open æ–¹æ³• å¸¦ä¸Šåœ°å€ä½œä¸ºå‚æ•°ï¼Œç›´æ¥æ‹¿åˆ°äº†æ•´ä¸ªé¡µé¢çš„ä»£ç ï¼Œæ³¨æ„è¿”å›çš„ä¸æ˜¯ string è€Œæ˜¯ä¸€ä¸ª StringIO å¯¹è±¡ï¼ŒåŒ…å«äº†å…³äºå¯¹è±¡çš„å¾ˆå¤šå±æ€§ï¼Œè€Œcontent å¹¶æ²¡æœ‰å…¨éƒ¨å†™åœ¨é‡Œé¢</p>

<p>é€šè¿‡ gets æˆ‘ä»¬å°±å¯ä»¥ä¸€è¡Œä¸€è¡Œæ‹¿åˆ°è¿”å›çš„ä¿¡æ¯</p>

<p>é€šè¿‡IO ç›¸å…³ï¼ˆåœ¨StringIOå¯¹è±¡ä¸ŠåŸºæœ¬éƒ½å¯ä»¥ç”¨ï¼‰çš„æ–¹æ³•å¯ä»¥ä»¥å„ç§æ–¹å¼è¯»å–å¯¹è±¡ä¸­çš„ content</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">rubypage</span><span class="p">.</span><span class="nf">size</span>
 <span class="o">=&gt;</span> <span class="mi">6675</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">rubypage</span><span class="p">.</span><span class="nf">readlines</span><span class="p">.</span><span class="nf">size</span>
 <span class="o">=&gt;</span> <span class="mi">129</span>
<span class="mf">2.5</span><span class="o">.</span><span class="mi">0</span> <span class="p">:</span><span class="mo">010</span> <span class="o">&gt;</span>
</code></pre></div></div>

<h2 id="summary">Summary</h2>

<p>In this chapter youâ€™ve seen</p>

<ul>
  <li>
    <p>I/O (keyboard and screen) and file operations in Ruby
ruby ä¸­çš„IOæ“ä½œ</p>
  </li>
  <li>
    <p>File objects as enumerables
ä½œä¸ºå¯æšä¸¾å¯¹è±¡çš„File å®ä¾‹å¯¹è±¡</p>
  </li>
  <li>
    <p>The STDIN, STDOUT, and STDERR objects
STDIN STDOUT, ä»¥åŠ STDERR å¯¹è±¡</p>
  </li>
  <li>
    <p>The FileUtils module
std lib ä¸­çš„ module FileUtils</p>
  </li>
  <li>
    <p>The Pathname module
std lib ä¸­çš„ module Pathname</p>
  </li>
  <li>
    <p>The StringIO class
std lib ä¸­çš„ class IO</p>
  </li>
  <li>
    <p>The open-uri module
std lib ä¸­çš„ module open-uri</p>
  </li>
</ul>

<p>I/O operations are based on the IO class, of which File is a subclass. Much of what IO and File objects do consists of wrapped library calls; theyâ€™re basically API libraries that sit on top of system I/O facilities.
I/Oæ“ä½œæ˜¯åŸºäºIO classçš„ï¼ŒFile æ˜¯ä»–çš„subclass. IO å’Œ File ä¸­çš„è®¸å¤šæ–¹æ³•éƒ½å€Ÿé‰´è‡ªç³»ç»Ÿå±‚é¢çš„ I/O åŠŸèƒ½ã€‚</p>

<p>You can iterate through Ruby file handles as if they were arrays, using each, map, reject, and other methods from the Enumerable module, and Ruby will take care of the details of the file handling. If and when you need to, you can also address IO and File objects with lower-level commands.
ä½ å¯ä»¥æƒ³å¯¹å¾…arrayä¸€æ ·å¯¹fileå¯¹è±¡è¿›è¡Œè¿­ä»£æ“ä½œï¼Œä½¿ç”¨ each, map, reject, ç­‰æ¥è‡ª module Enumerable çš„æ–¹æ³•ã€‚ ä¸è¿‡åªè¦ä½ éœ€è¦ï¼Œä½ ä¹Ÿå¯ä»¥å¯¹ IO å’Œ File å¯¹è±¡è¿›è¡Œä½å±‚çº§çš„æ“ä½œã€‚</p>

<p>Some of the standard-library facilities for file manipulation are indispensable, and we looked at several: the FileUtils module, which provides an enriched toolkit for file and disk operations; the StringIO class, which lets you address a string as if it were an I/O stream; the Pathname extension, which allows for easy, extended operations on strings representing file-system paths; and open-uri, which makes it easy to â€œopenâ€ documents on the network.
å¾ˆå¤šstd libä¸­çš„æ–‡ä»¶æ“ä½œåŠŸèƒ½æ˜¯ä¸å¯è·å–çš„ï¼Œæˆ‘ä»¬çœ‹è¿‡ä¸€äº›ï¼š module FileUtils æä¾›äº†ä¸°å¯Œçš„æ–‡ä»¶å’Œç¡¬ç›˜å±‚é¢çš„æ“ä½œï¼› class StringIO èƒ½å¤Ÿè®©ä½ åƒå¯¹å¾…ä¸€ä¸ª I/O stream ä¸€æ ·å¯¹å¾…stringã€‚ Pathname è®©æˆ‘ä»¬èƒ½ä»¥ç®€å•ï¼Œå¯æ‹“å±•çš„æ–¹å¼å¯¹æ–‡ä»¶è·¯å¾„è¿›è¡Œæ“ä½œã€‚æœ€å open-uri è®©æˆ‘ä»¬èƒ½å¤Ÿæ–¹ä¾¿åœ°æ‰“å¼€ç½‘ç»œä¸Šçš„èµ„æºã€‚</p>

<p>We also looked at keyboard input and screen output, which are handled via IO objectsâ€”in particular, the standard input, output, and error I/O handles. Ruby lets you reassign these so you can redirect input and output as needed.
æˆ‘ä»¬ä¹Ÿäº†è§£äº†é”®ç›˜è¾“å…¥å’Œå±å¹•è¾“å‡ºï¼Œä»–ä»¬æ˜¯é€šè¿‡ IO å¯¹è±¡â€”â€”å‡†ç¡®çš„è¯´æ˜¯ stdin stdout stderrå¯¹è±¡æ¥è¿›è¡Œ I/O æ“ä½œçš„ã€‚ Ruby è®©ä½ èƒ½å¤Ÿé€šè¿‡é‡æ–°ç»™å¯¹åº”çš„ I/O å¯¹è±¡èµ‹å€¼é‡æ–°å®šå‘è¾“å‡ºå’Œè¾“å…¥çš„ä½ç½®ã€‚</p>

        </div>

        
          <div class="page-share">
  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Flearning%2520notes%2Fprogramming%2Fchapter-12-File-and-I-O-operations%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--facebook btn--small"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i> <span>Share</span></a>
  <a href="https://twitter.com/intent/tweet?text=Rubyist-c12-File+and+IO+operations%20http%3A%2F%2Flocalhost%3A4000%2Flearning%2520notes%2Fprogramming%2Fchapter-12-File-and-I-O-operations%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--twitter btn--small"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i> <span>Tweet</span></a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Flearning%2520notes%2Fprogramming%2Fchapter-12-File-and-I-O-operations%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--linkedin btn--small"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> <span>LinkedIn</span></a>
  <a href="https://reddit.com/submit?title=Rubyist-c12-File+and+IO+operations&url=http%3A%2F%2Flocalhost%3A4000%2Flearning%2520notes%2Fprogramming%2Fchapter-12-File-and-I-O-operations%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--reddit btn--small"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i> <span>Reddit</span></a>
</div>

        

        

        <nav class="page-pagination" role="navigation">
  
    <a class="page-previous" href="/learning%20notes/programming/Chapter-14-Callable-and-runnable-objects/">
      <h4 class="page-pagination-label">Previous</h4>
      <span class="page-pagination-title">
        <i class="fas fa-arrow-left"></i> Rubyist-c14-Callable and runnable objects

      </span>
    </a>
  

  
    <a class="page-next" href="/learning%20notes/programming/Chapter-15-Callbacks-hooks-and-runtime-introspection/">
      <h4 class="page-pagination-label">Next</h4>
      <span class="page-pagination-title">
        Rubyist-c15-Callbacks hooks and runtime introspection
 <i class="fas fa-arrow-right"></i>
      </span>
    </a>
  
</nav>

      </div>
    </div>
  </article>
</main>


    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->


  <!--<div class="social-icons"><a class="social-icon" href="/atom.xml"><i class="fas fa-rss-square fa-2x" title="Feed"></i></a></div>-->

  <div class="copyright">
    
    <p>&copy; 2018  Caven.</p> <p>Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll. </a>
       Theme: <a href="https://github.com/mmistakes/so-simple-theme" rel="nofollow">So Simple</a>.</p>
    
  </div>
</footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>


  </body>

</html>
